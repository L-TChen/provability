\documentclass[a4paper,UKenglish,numberwithinsect,cleveref,thm-restate]{lipics-v2021}
\numberwithin{equation}{section}

\usepackage{mathrsfs}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{bussproofs}
\usepackage{xspace}

\usepackage{stmaryrd}
\usepackage{ragged2e}
\usepackage{varwidth}

% 
\usepackage[draft,noinline,margin]{fixme}
\FXRegisterAuthor{lt}{alt}{LT}
\FXRegisterAuthor{hs}{ahs}{Josh}

%
\newcommand{\eqv}[2]{\ensuremath{#1 \simeq #2}\xspace}

% the following is copied from the HoTT book
\newcommand{\trunc}[2]{\mathopen{}\left\Vert #2\right\Vert_{#1}\mathclose{}}
\newcommand{\ttrunc}[2]{\bigl\Vert #2\bigr\Vert_{#1}}
\newcommand{\Trunc}[2]{\Bigl\Vert #2\Bigr\Vert_{#1}}
\newcommand{\truncf}[1]{\Vert \blank \Vert_{#1}}
\newcommand{\tproj}[3][]{\mathopen{}\left|#3\right|_{#2}^{#1}\mathclose{}}
\newcommand{\tprojf}[2][]{|\blank|_{#2}^{#1}}
\def\pizero{\trunc0}

\newcommand{\brck}[1]{\trunc{}{#1}}
\newcommand{\bbrck}[1]{\ttrunc{}{#1}}
\newcommand{\Brck}[1]{\Trunc{}{#1}}
\newcommand{\bproj}[1]{\tproj{}{#1}}
\newcommand{\bprojf}{\tprojf{}}

\newbox\qqBoxA
\newdimen\qqCornerHgt
\setbox\qqBoxA=\hbox{$\ulcorner$}
\global\qqCornerHgt=\ht\qqBoxA
\newdimen\qqArgHgt
\def\qquote #1{%
    \setbox\qqBoxA=\hbox{$#1$}%
    \qqArgHgt=\ht\qqBoxA%
    \ifnum     \qqArgHgt<\qqCornerHgt \qqArgHgt=0pt%
    \else \advance \qqArgHgt by -\qqCornerHgt%
    \fi \raise\qqArgHgt\hbox{$\ulcorner$} \box\qqBoxA %
    \raise\qqArgHgt\hbox{$\urcorner$}}
%
\newcommand{\Tree}{\mathcal{S}}
\newcommand{\later}{\mathord{\blacktriangleright}}
\newcommand{\laterp}{\mathord{\vartriangleright}}
\newcommand{\PER}{\mathbf{PER}}
\newcommand{\Nat}{\mathbb{N}}
\newcommand{\PP}{\mathscr{P}}
%\newcommand{\Asm}{\mathbf{Asm}}
\newcommand{\Asm}{\mathsf{Asm}}
\newcommand{\ASM}{\mathsf{ASM}}
\newcommand{\defeq}{\vcentcolon\equiv} 
\newcommand{\Univ}{\mathcal{U}}
\newcommand{\comp}{\circ}
\newcommand{\transport}{\mathsf{transport}}
\newcommand{\blank}{{-}}
\newcommand{\id}{\mathsf{id}}
\newcommand{\iid}{\mathit{id}}
\newcommand{\Unit}{\mathbf{1}}
\newcommand{\Empty}{\mathbf{0}}
\newcommand{\pr}{\mathsf{pr}}

\newcommand{\SFour}{\textbf{S4}}
\newcommand{\GL}{\textbf{GL}}

\newcommand{\Quote}{\mathtt{quote}}
\newcommand{\Eval}{\mathtt{eval}}
\newcommand{\Subst}{\mathtt{subst}}

\DeclareRobustCommand\longtwoheadrightarrow{\relbar\joinrel\twoheadrightarrow}
\newcommand{\reduce}{\longtwoheadrightarrow_{\beta}}
\newcommand{\onereduce}{\longrightarrow_{\beta}}

\newcommand{\anonymous}{\kern0.06em \vbox{\hrule\@width.5em}}
%
\theoremstyle{plain}
\newtheorem*{notation*}{Notation}

\title{A Realisability Semantics for Gödel-Löb Axiom in Guarded Homotopy Type Theory} 
\author{Liang-Ting Chen}%
  {Institute of Information Science, Academia Sinica, Taiwan~\url{https://l-tchen.github.io}}%
  {liang.ting.chen.tw@gmail.com}%
  {https://orcid.org/0000-0002-3250-1331}{}
\author{Hsiang-Shang Ko}%
  {Institute of Information Science, Academia Sinica, Taiwan~\url{https://josh-hs-ko.github.io}}%
  {joshko@iis.sinica.edu.tw}%
  {https://orcid.org/0000-0002-2439-1048}{}
\authorrunning{L.-T.~Chen and H.-S.~Ko}

\Copyright{Liang-Ting Chen and Hsiang-Shang Ko}
\ccsdesc{Theory of computation~Type theory}
\ccsdesc{Theory of computation~Logic}
\ccsdesc{Theory of computation~Constructive mathematics}
\keywords{Löb's theorem, provability, guarded recursion, realizability, homotopy type theory, modal type theory, metaprogramming}

\relatedversion{} %optional, e.g. full version hosted on arXiv
%\relatedversiondetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93]{Classification (e.g. Full Version, Extended Version, Previous Version}{URL to related version} %linktext and cite are optional

\supplement{The results were formalised in (Guarded) Cubical Agda with source code available at \url{https://github.com/L-TChen/provability}.}

\funding{This work was supported by the Ministry of Science and Technology of Taiwan under grant MOST~109-2222-E-001-002-MY3.}

\acknowledgements{\ltnote{Alex Kavvos, Tsung-Ju Chiang, Rasmus Ejlers Møgelberg, Churn-Jung Liau}}

\nolinenumbers 

%\hideLIPIcs  %uncomment to remove references to LIPIcs series

%Editor-only macros:: begin (do not touch as author)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\EventEditors{John Q. Open and Joan R. Access}
\EventNoEds{2}
\EventLongTitle{42nd Conference on Important Topics (CIT 2016)}
\EventShortTitle{CIT 2016}
\EventAcronym{CVIT}
\EventYear{2016}
\EventDate{December 24--27, 2016}
\EventLocation{Little Whinging, United Kingdom}
\EventLogo{}
\SeriesVolume{42}
\ArticleNo{23}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\maketitle

\begin{abstract}
  In this paper, we give a positive answer to a recent open problem---is there a categorical interpretation of the Gödel-Löb axiom~$\Box (\Box A \to A) \to \Box A$ which refutes the completeness principle $A \to \Box A$?

  We consider the $\PP$-category $\ASM(\Lambda)$ of assemblies on untyped $\lambda$-calculus and trackable maps with an exposure-like construction $\Box\colon \ASM(\Lambda) \looparrowright \ASM(\Lambda)$, internal to a guarded homotopy type theory, as the interpretation of the provability modality~$\Box$.
  We show that $\Box$ refutes the reflection principle $\Box A \to A$ and the completeness principle but proves the Gödel-Löb axiom.
  Of the utmost significance of the interpretation for $\Box A$ is that its denotation involves not only intensions, e.g., derivations of a proof, code of programs, or $\lambda$-terms modulo $\alpha$-equivalence given its provability reading but also their extensions enriched with a notion of computation stages. 

  Following the understanding of $\Box A$ as a type of typed code \`a la Davies and Pfenning, our work is a step towards extending type theories on which proof assistants are based with non-structural but guarded recursion for typed code while maintaining consistency.
\end{abstract}

\section{Introduction}\label{sec:intro}
\cite{Litak2014,Davies2001b}

In this paper, we use homotopy type theory, HoTT for short, as the foundation of mathematics. 
\paragraph*{Contributions}
\ltnote{intensional modality?}

\paragraph*{Plan of the paper}
\Cref{sec:preliminaries}
\Cref{sec:assemblies}
\Cref{sec:provability}
\Cref{sec:conclusion}

\paragraph*{Related work}
\cite{Visser2019,Beklemishev2006}
\cite{Kavvos2020}
\cite{Shamkanov2014,Shamkanov2016a}

\section{Preliminaries}\label{sec:preliminaries}

\subsection{Homotopy type theory}
In this section, we fix notations and highlight its difference with set-theoretic foundations relevant to this paper.
Most of, if not all, materials are standard and presented in the HoTT Book~\cite{hottbook}, so the reader comfortable with HoTT should feel free to skip this section.
\ltnote{(mere) proposition, set, structure vs.\ property}

\subsection{\texorpdfstring{$\PP$}{P}-Categories and exposures}
Instead of ordinary categories, we choose to work with $\PP$-categories which are pioneered by \v{C}ubri\'c et al.~\cite{Cubric1998a} to study normalisation in typed $\lambda$-calculus.
Its use is advocated by Kavvos~\cite{Kavvos2017b} who introduced a functor-like concept called \emph{exposure} exemplified by the Second Recursion Theorem and more in the realm of computability theory.

We sketch the main idea of the works by \v{C}ubri\'c et al.\ and by Kavvos \emph{op.\ cit.} as follows.
\begin{definition}
  A \emph{partial equivalence relation} is a symmetric and transitive relation.
  A \emph{$\PP$-set} $(X, \sim_X)$ is a set $X$ with a partial equivalence relation~$\sim_X$.
  A \emph{$\PP$-function} from $(X, \sim_X)$ to $(Y, \sim_Y)$ is a function $f\colon X \to Y$ which respects the relation~$\sim$ in the sense that $f\,x \sim_Y f\,y$ whenever $x \sim_X y$.
  An element $x \in X$ is \emph{well-defined} (with respect to $\sim$) if $x \sim x$.
\end{definition}
The identity function $\id_X : X \to X$ is a $\PP$-function.
The composite of two $\PP$-functions (by function composition) is again a $\PP$-function.
It turns out that $\PP$-sets and $\PP$-functions form a cartesian closed category~$\PP\text{-}\mathbf{Set}$, so by enriched category theory~\cite{Kelly1982} we have a notion of categories enriched by $\PP$-sets below.

\begin{definition}[{\cite[Definition~2.4]{Cubric1998a}}]
  A $\PP$-category is a category whose hom-sets are $\PP$-sets satisfying associativity and the identity law up to~$\sim$ in the sense that 
  \begin{romanenumerate}
  \item every object~$X$ has an identity morphism $\iid_X$, 
  \item $g f \sim g' f'$ whenever $g\sim g'$ and $f \sim f'$,
  \item $\iid \circ f \sim f'$ and $f \circ \iid \sim f'$ whenever $f \sim f'$,
  \item $h(gf) \sim (h'g')f'$ whenever $h\sim h'$, $g \sim g'$, and $f \sim f'$.
  \end{romanenumerate}
\end{definition}

A $\PP$-category has two kinds of equalities for morphisms---the underlying identity $=$ and the partial equivalence relation $\sim$ where the former is considered as the \emph{very intensional equality} and the latter as the \emph{extensional equality}. 
For example, this additional equality reflects the fact that $\alpha$-equivalent terms are $\beta$-equivalent but not the converse.
For categorical semantics where terms are interpreted as morphisms, an interpretation in a $\PP$-category is possible to discriminate these two kinds of identities, enabling us to model intensionality.

Next we recall the notion of exposures.
In short, an exposure is a $\PP$-functor which does not preserve but \emph{reflects} $\sim$-equality in the following sense.
\begin{definition}
  Given $\PP$-categories $\mathscr{C}$ and $\mathscr{D}$, an \emph{exposure} $Q\colon \mathscr{C} \looparrowright \mathscr{D}$ consists of \emph{(a)} a mapping $Q$ from objects $X$ of $\mathscr{C}$ to objects~$QX$ of $\mathscr{D}$ \emph{(b)} and from well-defined morphisms $f\colon X \to Y$ to well-defined morphisms $Qf\colon QX \to QY$ satisfying following properties
  \begin{romanenumerate}
    \item $Q\iid_X \sim \iid_{QX}$,
    \item $Q(g \circ f) \sim Qg \circ Qf$, and
    \item $f \sim g$ whenever $Qf \sim Qg$ for any two well-defined morphisms $f, g\colon X \to Y$. 
  \end{romanenumerate}
\end{definition}

The \emph{identity exposure} $\mathcal{I}$ maps every object to itself as well as morphisms.
Composing two exposures in the usual way clearly gives us an exposure. 

We also need a proper notion of morphisms between exposures below.
\begin{definition}
  Given exposures $P, Q\colon \mathscr{C} \looparrowright \mathscr{D}$, a \emph{(natural) transformation of exposures} $t\colon P \to Q$ is a family of well-defined morphisms $t_X \colon PX \to QX$ such that for every well-defined morphism~$f\colon X \to Y$ the following diagram
  \[
    \xymatrix{
      PX \ar[d]_{Pf} \ar[r]^{t_X} & QX \ar[d]^{Qf} \\
      PY \ar[r]_{t_Y} & QY
    }
  \]
  commutes up to the extensional equality~$\sim$.
\end{definition}
Likewise, we have a notion of \emph{comonadic exposures}\footnote{%
  The definition of comonadic exposures $Q$ by Kavvos~\cite{Kavvos2017b} requires additionally that $Q$ is cartesian and product-preserving.
  We will revisit this issue in~\Cref{sec:provability}.
}
as exposures $Q$ with transformations $\epsilon\colon Q \to \mathcal{I}$ and $\delta\colon Q \to Q^2$ satisfying the associative law and the unit laws up to~$\sim$.


Finally, there is a caveat regarding the actual type-theoretic formulation.
Even though we choose HoTT as the foundation, we do not require the carrier of a $\PP$-set to be a set ($0$-type) and the relation $\sim$ proof-irrelevant ($-1$-type). 

\section{\texorpdfstring{$\PP$}{P}-category of assemblies on \texorpdfstring{$\lambda$}{λ}-calculus}\label{sec:assemblies}

In this section, we introduce the $\PP$-category of assemblies on $\lambda$-calculus and trackable maps.
Assemblies are used to accommodate the information of how extensions are related to, or \emph{realised by}, intensions. Accordingly an appropriate notion of morphisms between assemblies is introduced to form a $\PP$-category, laying
the technical foundation for~\Cref{sec:provability}.


\subsection{Assembly}
An assembly on natural numbers is a set $\bproj{X}$ with a realisability relation $\mathord{\Vdash} \subseteq \mathbb{N} \times |X|$ such that for every $x$ in $\bproj{X}$ there exists some $a$ with $a \Vdash x$.
We say that $a$ \emph{realises} $x$ or $a$ is a \emph{realiser} of $x$ if $a \Vdash x$.
The notion of assemblies is nowadays often defined on a partial applicative structure $(A, \cdot)$ satisfying combinatory completeness, i.e.\ a partial combinatory algebra~\cite{Oosten2008}, PCA for short.
Our definition below is, apart from being type-theoretic, not an instance of the definition based on a PCA.
\begin{definition}\label{def:assembly}
  An \emph{assembly} $X$ on $\lambda$-calculus consists of a \emph{carrier} type $|X| : \Univ$ and a \emph{realisability} relation ${\Vdash_X}$ from $\Lambda_0$ to $|X|$ such that
  \emph{(a)} every $x : |X|$ merely has a term $M : \Lambda_0$ with $M \Vdash_X x$;
  \emph{(b)} $M \Vdash_X x$ whenever $M \reduce N$ and $N \Vdash_X x$.
  To put it formally, an assembly is a quadruple $(|X|, \Vdash_X, r_X, t_X)$ of type
  \[
    \Asm_0(\Lambda) \defeq \sum_{\bproj{X} : {\Univ}}\;\sum_{\mathord{\Vdash_X}:\Lambda_0 \to |X| \to \Univ} 
    \left(\mathord{\Vdash_X}\;\mathsf{respects}\;\mathord{\reduce}\right)
      \times \mathsf{isRightTotal}({\Vdash_X})
  \]
  where
  \begin{align}
    \left(\mathord{\Vdash_X}\;\mathsf{respects}\;\mathord{\twoheadrightarrow_\beta}\right) & \defeq\prod_{M N : \Lambda_0} \prod_{x : |X|} \left( \left(M \twoheadrightarrow_ \beta N\right) \to N \Vdash x \to M \Vdash x \right) \label{def:respect-reduction} \\      
    \mathsf{isRightTotal}(\Vdash_X) & \defeq \forall (x : |X|).\, \exists (M : \Lambda_0).\, M \Vdash x
    \label{def:right-total}
  \end{align}
\end{definition}

The required properties of \Cref{def:assembly} depart from the definition based on a PCA as follows. 
First, we do not require the type $M \Vdash_X x$ to be a proposition (contrary to its topos-theoretic formulation~\cite{Birkedal2002a}).
Although this additional requirement may simplify some constructions later, it is not necessary to derive our main results.
Second, as we would like to account for intensional equality in addition to extensional equality between terms,
we cannot identify $\beta$-equivalent terms \emph{a priori}.
As a result, the interaction with reduction $\reduce$ is formulated as~\eqref{def:respect-reduction} in line with the definition on an ordered PCA~\cite[Section~2.3]{Hofstra2003}.
%The formulation $\left(\mathord{\Vdash_X}\;\mathsf{respects}\;\mathord{\twoheadrightarrow_\beta}\right)$ is motivated by the confluence of $\lambda$-calculus where every two $\beta$-equivalent terms $M_i$ have a confluent term $N$, i.e.\ $M_i \reduce N$ for $i = 1, 2$.
Third, a plausible alternative to the right totality~\eqref{def:right-total} is
\[
  \Pi (x : |X|).\, \Sigma (M : \Lambda_0).\, M \Vdash x
\]
stating that each $x : |X|$ has an explicit choice of realisers.
%This is not reasonable if, say, $|X|$ is a function type since it amounts to giving a standard implementation in $\lambda$-calculus for any realisable function $f$.
However, with functional extensionality which holds in HoTT, any inhabitant of the alternative formulation leads to a \emph{contradiction}~\cite{Troelstra1977}. \ltnote{check this}

\begin{example}\label{ex:assembly-lambda}
  The type $\Lambda_0$ of closed terms with the reduction relation ${\reduce}$ as its realisability relation is an assembly $(\Lambda_0, \reduce, r_\Lambda, t_\Lambda)$ where $r_\Lambda$ and $t_\Lambda$ are given by the transitivity and the reflexivity of~$\reduce$.
  This assembly plays a major role in our study as the assembly of realisers.
\end{example}

\begin{example}
  The assembly $(\Nat, \Vdash_\Nat, r_{\Nat}, t_{\Nat})$ of natural numbers is also important but not in this paper.
  Nevertheless, we define a realisability relation $\Vdash_{\Nat}$ for natural numbers by
  \[
    M \Vdash_\Nat n \defeq M \reduce \mathtt{c}_n
  \]
  where $\mathtt{c}_n$ is the Church numeral of $n : \Nat$. The definitions of $r_\Nat$ and $t_\Nat$ are similar to those of~\Cref{ex:assembly-lambda}.  
\end{example}

\subsection{Trackable map}%

A morphism between assemblies on a PCA $(A, \cdot)$ is typically defined as a function~$f$ merely tracked by some $b \in A$ in the sense that there merely exists some $b$ such that $b \cdot a \Vdash f\,x$ whenever $a \Vdash x$.
In this case, $b$ is called the \emph{tracker} of $f$, or equivalently, $f$ is said to be \emph{tracked} by $b$.
It is noted by Kavvos~\cite{Kavvos2017b} that to reconcile intensionality we have to consider the tracker as part of structure instead of its mere existence.
\begin{definition}\label{def:trackable}
  Given assemblies $X$ and $Y$, a \emph{trackable map} from $X$ to $Y$ consists of a function $\bproj{f}$ from $|X|$ to $|Y|$ and a term $F$ with at most a free variable $\mathtt{x}$ such that $F[M/\mathtt{x}] \Vdash \bproj{f}\,x$ whenever $M \Vdash x$.
  In other words, a trackable map is an inhabitant of $\Asm_1(X, Y) \defeq \sum_{\bproj{f} : |X| \to |Y|} \sum_{F : \Lambda_1} \mathsf{Tracks}_{X, Y}(F, \bproj{f})$ where
  \[
    \mathsf{Tracks}_{X, Y}(F, \bproj{f}) \defeq \prod_{M : \Lambda_0} \prod_{x : |X|}
    \left( M \Vdash_X x \to F[M/\mathtt{x}] \Vdash_Y \bproj{f}\, x \right).
  \]
  Likewise, a \emph{merely trackable map} is an inhabitant of $\sum_{\bproj{f} : |X| \to |Y|} \exists_{F : \Lambda_1}\mathsf{Tracks}_{X, Y}(F, \bproj{f})$. 
\end{definition}

\begin{notation*}
  In the following context, we write $F[M]$ instead of $F[M/\mathtt{x}]$ if there is no danger of confusion since $F$ has at most one free variable.
\end{notation*}
By definition, a trackable map $f$ consists of not only a function $\bproj{f}$ between carriers but also its tracker $F$ and a transformation $\mathfrak{f}$ for realisability.

\begin{example}[Identity]
  Every assembly $X$ has a trackable map
  \[
    \iid_X \defeq (\id_{|X|}, \mathtt{x}, \pr_3)
    \quad\text{where}\quad
  \pr_3 \defeq \lambda M\,x\,r.\, r : \prod_{M : \Lambda_0} \prod_{x : |X|} \left( M \Vdash_X x \to M  \Vdash_X x  \right)
  \]
  since $\mathtt{x}[M]$ is judgementally equal to $M$.
\end{example}

Now we proceed with defining the composition of trackable maps. Let $f\colon X \to Y$ and $g\colon Y \to Z$ be trackable maps.
Then, the term substitution $(G, F) \mapsto G [ F ]$ can be thought as (intensional) function composition, since there is a path $p : G[F[M]] =_{\Lambda_0} G[F] [M]$ for any term $M$.
Given any $r : M \Vdash_X x$, the inhabitant $\mathfrak{g}(\mathfrak{f}\,r)$ is of type $G[F[M]]$ and its transportation along $p$ has type $G[F][M]$, defining an operation $\lambda M\,x\,r.\, \mathsf{transport}(p, \mathfrak{g}(\mathfrak{f}\,r))$.
Therefore, the above discussion amounts to an operation $(g, f) \mapsto g \circ f$ of type
\[
  \Asm_1(Y, Z) \to \Asm_1(X, Y) \to \Asm_1(X, Z).
\]
It is not hard but tedious to show the associativity and the identity law.

\begin{proposition}\label{prop:category-of-assemblies}
  The type $\Asm_0(\Lambda)$ of assemblies and the family of types $\Asm_1(X, Y)$ of trackable maps indexed by $X, Y$ with the composition $\circ$ for trackable maps and identities $\id$ form a category denoted by $\Asm(\Lambda)$.
\end{proposition}

%We may also consider reductions $F_1 \reduce F_2$ between morphisms $(f_1, F_1, \mathfrak{f}_1)$
%and $(f_2, F_2, \mathfrak{f}_2)$ as two cells since $F_1 \reduce F_2$ implies $F_1[M] \reduce F_2[M]$.
%That is, we do have a $2$-category of assemblies in the spirit of Seely's $2$-categorical model~\cite{Seely1987}.
%This line of research is out of scope of this paper, so we refrain ourselves from further discussion. 


\subsection{Extensional equality and \texorpdfstring{$\PP$}{P}-category of assemblies}

Now we define the (partial) equivalence relation $\sim$ referred as the \emph{extensional equality} on trackable maps by $f_1 \sim f_2$ if $\bproj{f_1} = \bproj{f_2}$.
It is not hard to see that $\Asm(\Lambda)$ with the equivalence relation $\sim$ is a $\PP$-category, denoted by $\ASM(\Lambda)$. 

We now investigate some of its basic properties.

\begin{example}[Terminal object]
  The unit assembly $\top \defeq (\Unit, \Vdash_{\Unit}, r_{\Unit}, t_{\Unit})$ is $\PP$-terminal where 
  \begin{romanenumerate}
    \item $\Unit$ is the unit type,  
    \item $\Vdash_{\Unit}$ a relation defined by $M \Vdash_{\Unit} \star \defeq M \reduce \mathtt{\lambda x.\, x}$, 
    \item $r_{\Unit}: (M \reduce N) \to (N \reduce L) \to (M \reduce L)$ given by the transitivity of the reduction relation $\reduce$,
    \item and $t_{\Unit}$ the fact that the only inhabitant $\star : \Unit$ has a realiser $\mathtt{\lambda x.\, x}$ (by reflexivity).
  \end{romanenumerate}
  The finality follows from the function extensionality.
\end{example}

Every inhabitant of (the carrier of) an assembly $X$ corresponds to a merely trackable map from $\top$ to $X$.
Moreover, distinct merely trackable maps can be separated by global elements in the category of assemblies and merely trackable maps. 
In $\ASM(\Lambda)$ where the trackers are part of trackable maps, we can construct a global element for any inhabitant $x : \bproj{X}$ if we know how $x$ is realised. 
\begin{lemma}\label{lem:global-elemnt}
  Let $X$ be an assembly. Then the following statements hold:
  \begin{enumerate}
    \item Every inhabitant $x_0 : \bproj{X}$ corresponds to a merely trackable map from $\top$ to $X$.
    \item Every pair of $x_0 : \bproj{X}$ and $M : \Lambda_0$ with $r_0 : M \Vdash_X x$ defines a global element of $X$, i.e.\ a trackable map from $\top$ to $X$.
  \end{enumerate}
\end{lemma}

One may expect that the terminal object $\top$ in~$\ASM(\Lambda)$ should still be a separator up to~$\sim$ in the sense that $f_1 \sim f_2$ if $f_1 \circ x \sim f_2 \circ x$ for every global element~$x$ of $X$.
However, due to the existence of non-trivial higher paths, the general case is a rather subtle issue~\cite{Kraus2015}. 
Nevertheless, it is indeed the case as expected if the codomain of a trackable map is a set. 
\begin{proposition}
  Every pair of trackable maps $f_1, f_2 : X \to Y$ with the carrier of $Y$ a set are extensionally equal if $f_1 \circ x \sim f_2 \circ x$ for every global element $x$ to $X$. 
\end{proposition}
\begin{proof}[Proof sketch]
  By function extensionality, it suffices to define a trackable map $(\mathsf{c}_x, M_x, \mathfrak{M}_x)$ from $\top$ to $X$ for any inhabitant $x : \bproj{X}$, where $\mathsf{c}_x(\star) = x$.
  Then, we show that there is a path $f_1\,x = f_2\,x$ independent of the choice of $M_x$ and $\mathfrak{M}_x$, by the right totality $t_X$, the recursion principle of propositional truncation, and the assumption that $\bproj{Y}$ is a set. 
\end{proof}

It is straightforward but tedious to define the $\PP$-product of assemblies, so we leave this as an exercise to the reader. 
\begin{example}[Initial object]
The empty assembly $\bot$ is $\PP$-initial consisting of the empty type $\Empty$ and a relation $\Vdash_\bot : \Lambda_0 \to \Empty \to \Univ$ given by the elimination rule for the empty type.
The other two components $r_\Empty$ and $t_\Empty$ are trivial.
\end{example}

In addition, one can show that $\bot$ is even a \emph{strict} initial object. That is, 
\begin{proposition}\label{prop:strict-initial}
  Any trackable map from some assembly $X$ to $\bot$ is a $\PP$-isomorphism. 
\end{proposition}
The strictness of $\bot$ follows easily from that for any type $X$ with a function $X \to \Empty$ one can show the equivalence $\eqv{\Empty}{X}$ in HoTT.
From the strictness of the initial object, no morphism from $\top$ to $\bot$ could exist, since $\top$ is not equivalent to $\bot$.

The construction of exponential $X \Rightarrow Y$ is a bit intriguing.
With the definition of trackable maps, we may expect the exponential assembly $X \Rightarrow Y$ to consist of trackable maps.
However, the exponential assembly $X \Rightarrow Y$ has the type of \emph{merely} trackable maps as its carrier~\cite{Kavvos2017b}, since the carrier is meant to be the type of extensions of trackable maps.
\begin{example}[Exponential]
  Given assemblies $X$ and $Y$, define
  \begin{align*}
    \bproj{X \Rightarrow Y} & \defeq \sum_{f : |X| \to |Y|} \exists (F : \Lambda_1).\, \mathsf{Tracks}_{X, Y}(F, f) \equiv \sum_{f : |X| \to |Y|} \brck{\sum_{F : \Lambda_1} \mathsf{Tracks}_{X, Y}(F, f) }
  \end{align*}
  with the realisability relation 
  \[
    L \Vdash_{X \Rightarrow Y} (f, \star) \defeq \prod_{M : \Lambda_0} \prod_{x : |X|}\left( M \Vdash_X x \to L\,M \Vdash_Y f\,x\right).
  \]
  It remains to construct $r_{X\Rightarrow Y}$ and $t_{X \Rightarrow Y}$. 
  We know that $L' \reduce L$ implies $L'\,M \reduce L\,M$, so $L'$ realises $(f, \star)$ whenever $L$ realises $(f, \star)$ and $L' \reduce L$ by $r_Y$.
  For every $(f, \star) : |X \Rightarrow Y|$, there merely exists a tracker of $f$, say $F$.
  We see that $L \defeq \left(\mathtt{\lambda x}.\,F\right)$ realises $(f, \star)$, since
  $\left(\mathtt{\lambda x}.\,F\right)\,M \onereduce F[M]$ for any $M$ and $F[M] \Vdash_Y f\,x$ whenever $M \Vdash x$.
  By applying the recursion principle of the truncated type $\brck{\sum_{F : \Lambda_1} \mathsf{Tracks}_{X, Y}(F, f) }$ to the second component of $(f, \star)$, there merely exists a realiser of $(f, \star)$, i.e.\ an inhabitant $t_{X \Rightarrow Y}$ for the right totality.

  \ltnote{show that $X \Rightarrow Y$ has the required universal property formally.}
\end{example}

To sum up, we have just showed that $\ASM(\Lambda)$ has a strict initial object, finite products, and exponentials.
\begin{corollary}
  $\ASM(\Lambda)$ is a cartesian closed $\PP$-category with a strict initial object.
\end{corollary}
\ltnote{shall we show that $\ASM(\Lambda)$ has a natural number object?}

\section{Realisability semantics for two modalities}\label{sec:provability}

In this section, we first introduce a comonadic exposure $\boxtimes\colon \ASM(\Lambda) \looparrowright \ASM(\Lambda)$ which models a $S4$ modality but different from the exposure $\boxtimes_K$ introduced by Kavvos~\cite[Section~9.1]{Kavvos2017b}.
For example, $\boxtimes_K$ preserves finite products including the terminal object~$\top$, but ours does not with good reason. 
Most importantly, we are able to refute the completeness principle $X \to \boxtimes X$ understood as a quoting function from the computational perspective, while we did not find a way to refute it using $\boxtimes_K$.
Hitherto, we complete our cook's tour of the previous set-theoretic results based on a partial combinatory algebra in HoTT.

Thereafter, we use an extension of cubical type theory---Clocked Cubical Type Theory~\cite{Bahr2017,Kristensen2021}---and introduce an exposure-like construction $\Box$ to model the provability modality.
This construction exploits Nakano's later modality so that the intuitive meaning of $\Box X$ can be expressed cleanly.
We will show that $\Box$ refutes not only the completeness principle by the same argument for $\boxtimes$ but also the reflection principle $\Box X \to X$ which is valid for $\boxtimes$ but logically inconsistent with Gödel-Löb axiom.
Finally, we establish one of the main contribution of this paper: given a trackable map $f : \Box X \to X$ tracked by~$F$ there is an inhabitant of $\Box X$ realised by~$F[\qquote{\mathsf{fix}\,F}]$
where $\mathsf{fix}\,F$ is the fixpoint given by the Second Recursion Theorem.
The categorical form of the Gödel-Löb axiom in $\ASM(\Lambda)$ follows.

\subsection{A recap: Gödel encoding and the Second Recursion Theorem}\label{subsec:godel}
Before entering into the main topic of this section, we review the Second Recursion Theorem in $\lambda$-calculus.
All details can be found in the classic textbook on by Barendregt~\cite[Section~6.5]{Barendregt1984a}.

Recall that in $\lambda$-calculus there is a function between $\lambda$-terms
\[
  \qquote{\cdot} : \Lambda \to \Lambda_0
\]
mapping any term $M$ to a closed term $\qquote{M}$ such that $\qquote{M}$ is normal,
$M \equiv_\alpha N$ whenever $\qquote{M} \equiv_\alpha \qquote{N}$, and moreover there are open terms $\mathtt{ap}, \mathtt{subst}, \mathtt{quote}$, and $\mathtt{eval}$ satisfying

\begin{align*}
  (\lambda \mathtt{x\,y}.\,\mathtt{ap})\,\qquote{M}\,\qquote{N} & \reduce \qquote{M\,N}
                                                                & (\lambda \mathtt{x\,y}.\, \mathtt{subst})\,\qquote{F}\,\qquote{N} & \reduce \qquote{F[N]} \\
  (\lambda \mathtt{x}.\, \mathtt{quote})\,\qquote{M} & \reduce \qquote{\qquote{M}}         
                                                     & (\lambda \mathtt{x}.\, \mathtt{eval})\,\qquote{M} & \reduce M.
\end{align*}
The function $\qquote{\cdot}$ is called a \emph{Gödel encoding}.
By convention the quoted term $\qquote{M}$ is called a Gödel \emph{number} since the encoding function $\qquote{\cdot}$ is defined by assigning a natural number $\#M$ represented as a Church numeral $\mathbf{c}_{\#M}$ to every term~$M$, a method invented by Gödel to prove Incompleteness Theorems.
By the nature of our characterisation it does not have to be a number at all, so we refrain from calling $\qquote{M}$ a number. 
Instead, $\qquote{M}$ is simply called a \emph{code} of $M$. 
For details on the axiomatic characterisation of encoding, see Polonsky~\cite{Polonsky2011}.


Note that the term $\mathtt{quote}$ can only compute the code of a term $\qquote{M}$ already in a quoted form instead of any arbitrary term $M$.
Otherwise, assume a term $\mathtt{Q}$ with $\mathtt{Q}\,M \reduce \qquote{M}$ for any arbitrary $M$.
Then, consider $\mathtt{I} \defeq \mathtt{\lambda x.\, x}$ and $\mathtt{I}\,\mathtt{I}$. 
We have $\mathtt{Q}\,(\mathtt{I}\,\mathtt{I}) \reduce \qquote{\mathtt{I}\,\mathtt{I}}$ by assumption but also $\mathtt{Q}\,(\mathtt{I}\,\mathtt{I}) \reduce \mathtt{Q}\,\mathtt{I}\reduce \qquote{I}$.
Hence, by confluence and the assumption that $\qquote{M}$ is normal, it follows that $\qquote{I\,I} \equiv_\alpha \qquote{I}$ and thus $\mathtt{I\,I} \equiv_\alpha \mathtt{I}$, a contradiction.

Contrary to the well-known Kleene's first recursion theorem, his second recursion theorem which works for \emph{code} is lesser known but more interesting.

\begin{theorem}[Second Recursion Theorem]
  Every term $F$ in untyped $\lambda$-calculus has a term $M$ with $M \reduce F\,\qquote{M}$.
\end{theorem}

If $F$ is in the form of abstraction, the above theorem boils down to the following case.
\begin{corollary}\label{coro:variant-of-SRT}
  Let $F$ be a term with a free variable~$\mathtt{x}$.
  Then, there exists a term $\mathsf{fix}\,F$ with $\mathsf{fix}\,F \reduce F[\qquote{\mathsf{fix}\,F}/\mathtt{x}]$.
\end{corollary}

\subsection{A comonadic exposure for \texorpdfstring{\SFour}{S4} modality}
An assembly $X$ records the interplay between intensions, i.e.\ untyped $\lambda$-terms, and extensions, so it is possible to bring out intensions to the level of extensions by pairing $x : \bproj{X}$ with a term $M$ which merely realises $x$ as the carrier of $\boxtimes X$.
A pair $(M, x)$ with $\star : \brck{M \Vdash_X x}$ should be thought as the extension $x$ along with its \emph{extensional} representation~$M$.  
Thus, we argue that $(M, x, \star)$ shall be realised by terms which are $\beta$-equivalent to its code $\qquote{M}$ (instead of $M$ as proposed by Kavvos~\cite{Kavvos2017b}), since terms $N$ with $N \reduce \qquote{M}$ are \emph{intensional} representations of $M$.
In short, the carrier and the realisability relation are defined as
\[
  \bproj{\boxtimes X} \defeq \sum_{M : \Lambda_0} \sum_{x : \bproj{X}} \brck{M \Vdash x}
  \quad\text{and}\quad
  N \Vdash_{\boxtimes X} (M, x, \star) \defeq N \reduce \qquote{M}
\]
respectively.
It turns out that $\boxtimes X \defeq (\bproj{\boxtimes X}, \Vdash_{\boxtimes X}, r_{\boxtimes X}, t_{\boxtimes X})$ is indeed an assembly where $r_{\boxtimes X}$ and $t_{\boxtimes X}$ are the transitivity and the reflexivity of $\reduce$.

As for the mapping on morphisms, consider any trackable map $f$ from $X$ to $Y$.
We define $\boxtimes f \defeq (\bproj{f}^\boxtimes, F^\boxtimes, \mathfrak{f}^\boxtimes)\colon \boxtimes X \to \boxtimes Y$ as follows.
Recall that the propositional truncation $\brck{\blank}$ is functorial, so
\[
  \bproj{f}^\boxtimes (M, x, \star) \defeq (F[M], \bproj{f}\,x, \brck{\mathfrak{f}\,M\,x}\,\star)
\]
is a function from $\bproj{\boxtimes X}$ to $\bproj{\boxtimes Y}$.
To give a tracker of $f^\boxtimes$, recall that there is a term $\mathtt{subst}$ performing term substitution on codes, so the term $F^\boxtimes \defeq \mathtt{subst}\,\qquote{F}\,\mathtt{x}$ tracks $f^\boxtimes$ by
\begin{align*}
  \left(\mathtt{subst} \,\qquote{F}\,\mathtt{x}\right)[N/\mathtt{x}]
  \equiv  {} & \mathtt{subst}\,\qquote{F}\,N \\
  \reduce {} & \mathtt{subst}\,\qquote{F}\,\qquote{M} \\
  \reduce {} & \qquote{F[M]} \Vdash_{\boxtimes Y} f^\boxtimes(M, x, \star)
\end{align*}
completing the definition of $\mathfrak{f}^\boxtimes$.
In short, $\boxtimes(f, F, \mathfrak{f}) \defeq(f^\boxtimes, F^\boxtimes, \mathfrak{f}^\boxtimes)$ is a trackable map.
\begin{theorem}[{cf.~\cite[Theorem~11]{Kavvos2017b}}]\label{thm:S4-exposure}
  $\boxtimes\colon \ASM(\Lambda) \looparrowright \ASM(\Lambda)$ is an exposure.
  Moreover, $\boxtimes$ has a comonadic structure given by families of trackable maps
  \begin{romanenumerate}
    \item the counit $\epsilon_A \colon \boxtimes X \to X$
    \item the comultiplication $\delta_A \colon \boxtimes X \to \boxtimes \boxtimes X$
  \end{romanenumerate}
  natural in $X$. 
\end{theorem}
\begin{proof}[Proof sketch]
  We only sketch the proof of three less obvious statements here---the preservation of identities and the construction of natural transformations $\epsilon\colon \boxtimes \to \mathcal{I}_{\ASM(\Lambda)}$ and $\delta\colon \boxtimes \to \boxtimes\boxtimes$. 
  To show that $\boxtimes$ preserves identities, we use that fact that the propositional truncation $\brck{\blank}$ is a functor which preserves identities and that $\pr_3$ is a third projection.
  Then, it follows that $\brck{\pr_3\,M\,x} \equiv \brck{\id} = \id$ and thus $\id_{\bproj{X}}^\boxtimes (M, x, \star) \equiv (\mathtt{x}[M], x, \brck{\pr_3\,M\,x}\,\star) \equiv \id_{\bproj{\boxtimes X}}(M, x, \star)$.

  For the families of maps $\boxtimes X \to X$ and $\boxtimes X \to \boxtimes \boxtimes X$ natural in $X$, recall that there are terms $\mathtt{eval}$ and $\mathtt{quote}$ which evaluates a code to its representing term and computes the code $\qquote{N}$ of a given term~$N \equiv \qquote{M}$ in the form of code respectively. That is, 
  \[
    \mathtt{eval}\,\qquote{M} \reduce M
    \quad\text{and}\quad
    \mathtt{quote}\,\qquote{M} \reduce \qquote{\qquote{M}}.
  \]
Use these terms as trackers for $\boxtimes X \to X$ and $\boxtimes X \to \boxtimes \boxtimes X$ respectively.
It is now straightforward to define the required natural transformations between exposures.
\end{proof}
In particular, the counit $\epsilon_X\colon \Box X \to X$ is understood as the evaluation of the intension $M$ to its extension~$x$, as justified by the its tracker~$\mathtt{eval}$. 

\begin{remark} \label{remark:difference-boxtimes}
\ltnote[inline,nomargin]{$\boxtimes$ is not cartesian and not product-preserving. Moreover $\boxtimes_K \Nat$ is not isomorphic ot $\Nat$.}
\end{remark}

The following theorem is another difference between $\boxtimes_K$ and $\boxtimes$.
\begin{theorem}\label{thm:S4-no-quoting}
  There is no natural transformation from the identity $\mathcal{I}$ to $\boxtimes$.
\end{theorem}
We show the existence of such a natural transformation implies the existence of a term $\mathsf{quote}'$ with $\mathsf{quote}'[M] \reduce \qquote{M}$ using naturality and the fact that $\Lambda_0$ itself has an assembly structure (\Cref{ex:assembly-lambda}), but $\Quote'$ cannot exist as discussed in \Cref{subsec:godel}.
\begin{proof}
  Assume that such a family of maps $\eta_X\colon X \to \boxtimes X$ natural in $X$ exist.
  Every closed term $M_0$ corresponds to a trackable map $\widehat{M_0} \defeq (\mathsf{c}_{M_0}, M_0, \mathfrak{M}_0) \colon \top \to \Lambda$ where $\mathsf{c}_{M_0}$ is the constant function with the value $M_0$ and $\mathfrak{M}_0$ is also the constant function with the value $\mathsf{refl}_{\twoheadrightarrow} M_0 : M_0 \reduce M_0$.
  Consider the naturality of $\eta$
  \[
    \xymatrix{
      \top \ar[r]^{\eta_\top} \ar[d]_{\widehat{M_0}} & \boxtimes \ar[d]^{\boxtimes \widehat{M_0}} \top \\
      \Lambda \ar[r]_{\eta_\Lambda} & \boxtimes \Lambda
    }
  \]
  which commutes up to $\sim$, namely, ${\eta_\Lambda \circ \widehat{M_0}} \sim {\boxtimes \widehat{M_0} \circ \eta_\top}$.
  Note that $\boxtimes \widehat{M_0}$ maps an arbitrary inhabitant of $\boxtimes \top$ to $(M_0, M_0, \bproj{\mathsf{refl}_{\twoheadrightarrow}M_0})$ so that $\bproj{\eta}$ must satisfy 
\[
  \bproj{\eta_\Lambda}\,M_0 \equiv \left(\bproj{\eta_\Lambda} \circ \widehat{M_0}\right)\,\star = \left(\boxtimes \widehat{M_0} \circ \eta_\top \right)\,\star \equiv (M_0, M_0, \bproj{\mathsf{refl}_{\twoheadrightarrow}M_0}).
\]
By assumption, $\eta_\Lambda$ is tracked by some term $\mathtt{quote}'$ with $\mathtt{quote}'[N] \reduce \qquote{M}$ whenever $N \reduce M$.
However, it implies that $\mathtt{quote}'[M] \reduce \qquote{M}$ for any $M$, a contradiction.
\end{proof}

\ltnote{can $\mathcal{I} \to \boxtimes_K$ be refutable?}


\begin{remark}\label{remark:S4-modality}
The modal type theory considered by Davies and Pfenning~\cite{Davies2001b} is a dual-context simple type theory extended with a \SFour modality $\Box$, a construct $\mathtt{box}$, a $\mathtt{let}$-expression for boxed terms, and typing rules below.
\[
\begin{minipage}{.47\linewidth}
  \begin{prooftree}
    \AxiomC{$\Delta; \cdot \vdash E : A$}
    \UnaryInfC{$\Delta; \Gamma \vdash \mathtt{box}\,E:\Box A$}
  \end{prooftree}
\end{minipage}%
\begin{minipage}{0.47\linewidth}
  \begin{prooftree}
    \AxiomC{$\Delta; \Gamma \vdash E_1 : \Box A$}
    \AxiomC{$\Delta, u : A; \Gamma \vdash E_2 : B$}
  \BinaryInfC{$\Delta; \Gamma \vdash \mathtt{let}\,\mathtt{box}\, u = E_1\, \mathtt{in}\,E_2 : B$}
  \end{prooftree}
\end{minipage}
\]
Following \Cref{thm:S4-exposure,thm:S4-no-quoting}, we anticipate an interpretation of $\Box$ to justify the `omitted congruence rule` for the $\mathtt{box}$ construct~\cite[Section~2.5]{Davies2001b} and the absence of quoting function $A \to \Box A$ in their system respectively.
\end{remark}

\subsection{An exposure for \texorpdfstring{\GL}{GL} modality}
It is known that the Gödel-Löb axiom $\Box(\Box A \to A) \to \Box A$ is incompatible with the reflection principle $\Box A \to A$.
Indeed, let $A$ be the falsity $\bot$ for both laws. Then, we have
\[
  \Box(\Box \bot \to \bot) \to \bot
  \quad\text{and}\quad
  \Box \bot \to \bot
\]
By the necessitation rule and modus ponens, $\Box (\Box \bot \to \bot)$ as well as $\bot$ are derivable.
Yet, by \Cref{prop:strict-initial,thm:S4-exposure}, we cannot expect the exposure $\boxtimes$ to model the Gödel-Löb axiom.
Mysteriously, the provability modality $\Box$ and the Gödel-Löb axiom are suggested to be understood also as the type of code of type~$A$ (cf.~\Cref{remark:S4-modality}) and as \emph{intensional recursion} respectively from the computational perspective~\cite{Kavvos2017b}, if one is willing to give up consistency.
This compromise, however, is not possible here.

To untie the knot but to retain the interpretation of $\Box A$ as code of type~$A$, we refine our interpretation with a notion of \emph{computation stages}. 
Considering the counit $\epsilon_X\colon \boxtimes X \to X$, it is possible to evaluate $(M, x, \star)$ because the code is already available for doing so.
And, the provability reading of $\Box$ suggests that inhabitants of $\Box X$ are not available now but in the later stage.
To express this idea cleanly, we work in an extension of HoTT with the support of Nakano's later modality~\cite{Nakano2000}.

\subsubsection{Digression: Clocked Cubical Type Theory}
\ltnote[inline,nomargin]{Introduce clocked cubical type theory here}
\begin{lemma}
  \[
    \eqv{\rhd \sum_{x : A} B\,x}{\sum_{x : \rhd A} \rhd (\alpha : \kappa).\,B\,(x[\alpha])}
  \]
\end{lemma}

\begin{corollary}[Löb induction on $\sum$-types]\label{coro:lob-induction-sum}
  \[
    \sum_{x : \rhd A} \rhd (\alpha : \kappa).\,B\,(x[\alpha]) \to \sum_{x : A} B\,x
  \]
  implies 
  \[
    \sum_{x : A} B\,x
  \]
\end{corollary}

\begin{lemma}\label{lem:later-sum}
  For $A : \Univ$ and $B : A \to \Univ$, we have an equivalence
  \[
    \eqv{\rhd^\kappa\sum_{x : A} B\,x}{\sum_{x : \rhd^\kappa A} \rhd (\alpha : \kappa).\, B (x [\alpha])}.
  \]
\end{lemma}
\begin{lemma}\label{lem:proposition-closed-under-later}
  For every $A : \mathord{\rhd}\,\Univ$ if $\rhd (\alpha : \mathbb{T}).\,\mathsf{isProp}(A[\alpha])$ then $\rhd(\alpha : \mathbb{T}).\,A[\alpha]$ is also a proposition. 
\end{lemma}

\begin{lemma}\label{lem:later-identity}
  $\left(\forall \kappa.\, \rhd^\kappa f = \rhd^\kappa g\right)$ implies $f = g$. 
\end{lemma}

\begin{definition}[Clocked exposure]
\end{definition}

\subsubsection{Back to \texorpdfstring{$\mathsf{GL}$}{GL}}

Now we introduce the clocked exposure $\Box^\kappa \colon \ASM(\Lambda) \to \ASM(\Lambda)$ indexed by clocks~$\kappa$ modelling the $\mathsf{GL}$ modality as follows. 
For any assembly $X$, the carrier of $\Box^\kappa X$ and the realisability relation are now defined as
\[
  \bproj{\Box^\kappa X} \defeq \sum_{M : \Lambda_0} \sum_{x : {\rhd^\kappa \bproj{X}}} \rhd (\alpha : \kappa) .\, \brck{M \Vdash_X x [\alpha]}
  \quad\text{and}\quad
  N \Vdash_{\Box^\kappa X} (M, x, \star) \defeq N \reduce \qquote{M}
\]
where $\rhd (\alpha : \kappa) .\, \brck{M \Vdash_X x [\alpha]}$ is a proposition by~\Cref{lem:proposition-closed-under-later} and the relation $\Vdash_{\Box^\kappa X}$ is defined as the same as the comonadic exposure~$\boxtimes$.
The only difference between carriers $\bproj{\Box^\kappa X}$ and $\bproj{\boxtimes X}$ is the extensional part which becomes $\rhd^\kappa \bproj{X}$ so that the extension of $(M, x, \star)$ is available in the next stage but not earlier (within the clock $\kappa$).
Similarly, $\Box^\kappa X \defeq (\bproj{\Box^\kappa X}, \Vdash_{\Box^\kappa X}, r_{\Box^\kappa X}, t_{\Box^\kappa X})$ is an assembly where $r_{\Box^\kappa X}$ and $t_{\Box^\kappa X}$ are given by the transitivity and the reflexivity of $\reduce$. 

%\begin{notation*}
%  To avoid clumsy notations, the superscript of $\Box^\kappa$ is suppressed when appropriate.
%\end{notation*}

For any trackable map $f$ from $X$ to $Y$, also define $\Box f$ as the same as $\boxtimes f$ with the exception of the function $\bproj{\Box f}$ between carriers which are now involved with a later modality:
\[
  \bproj{\Box^\kappa f}(M, x, \star) \defeq (F[M], \rhd^\kappa \bproj{f}\, x, \lambda \alpha.\, \brck{\mathfrak{f}\,M\,x[\alpha]}\,{\star}[\alpha])
\]
where $(\rhd^\kappa f\, x)[\alpha]$ is judgementally equal to $f(x[\alpha])$, and $\rhd^\kappa \bproj{f} : \rhd^\kappa \bproj{X} \to \rhd^\kappa \bproj{Y}$ is given by the functoriality of the later modality~$\mathord{\rhd}^\kappa$.
The very same argument for $\boxtimes f$ shows that $\Box^\kappa f$ is indeed a trackable map from $\bproj{\Box^\kappa X}$ to $\bproj{\Box^\kappa Y}$.

It is straightforward to show that $\Box^\kappa$ is a clocked-exposure by \Cref{lem:later-identity}.
\begin{theorem}\label{thm:GL-exposure}
  $\Box^\kappa \colon \ASM(\Lambda) \looparrowright \ASM(\Lambda)$ is a clocked exposure.
  \ltnote{$\Box^\kappa$ does not reflect~$\sim$ since we need $\mathtt{force}\colon (\forall \kappa.\, \rhd^\kappa A) \to (\forall \kappa.\, A)$.}
\end{theorem}

Similar to~\Cref{thm:S4-no-quoting}, we can refute the existence of a family of trackable maps $\eta_X\colon X \to \Box X$ natural in $X$ by the non-existence of the term $\mathtt{Q}$ with $\mathtt{Q}\,M \reduce \qquote{M}$ for any arbitrary term $M$.
\begin{theorem}\label{thm:GL-no-quoting}
  There is no natural transformation from $\mathcal{I}$ to $\Box^\kappa$.
\end{theorem}


On the other hand, it is not possible to have a family of trackable maps $\epsilon_X$ from $\Box^\kappa X$ to $X$ natural in $X$, since the extension part of an inhabitant of $\Box^\kappa X$ can only be projected in a time step away from now.
\begin{theorem}\label{thm:GL-no-eval}
  There is no natural transformation from $\Box^\kappa$ to $\mathcal{I}$.
\end{theorem}
\begin{proof}
  Assume such a natural transformation~$\epsilon$. In particular, consider $\epsilon_\bot \colon \Box^\kappa \bot \to \bot$. 
  We will show that there is $\mathsf{bang}\colon \rhd \Empty \to \Empty$, so by guarded recursion $\mathsf{fix}\,\mathsf{bang} : \Empty$ is a contradiction.
  
  First, let $x$ be an inhabitant of $\rhd \Empty$. We aim at constructing an inhabitant $(M, x, \star_M)$ of
  \[
    \Box^\kappa \bot \equiv \sum_{M : \Lambda_0} \sum_{x : {\rhd \Empty}} \rhd (\alpha : \kappa) .\, \brck{M \Vdash_\bot x [\alpha]}
  \]
  so that the function $\bproj{\epsilon_\bot}$ from $\bproj{\Box^\kappa \bot}$ to $\bproj{\bot} \equiv \Empty$ can be applied.
  For arbitrary closed term $M$, say $\mathtt{\lambda x.\, x}$, we apply the recursion principle~$\mathsf{rec}_{\Empty}$ of the empty type to~$x$ after a time step, so 
  \[
    \star_M \defeq \lambda \alpha.\, \mathsf{rec}_{\Empty}\,\brck{M \Vdash_\bot x[\alpha]}\,x[\alpha]
  \]
  is an inhabitant of $\rhd (\alpha : \kappa) .\, \brck{M \Vdash_\bot x [\alpha]}$ and thus $(M, x, \star_M)$ is of type $\bproj{\Box^\kappa \bot}$. 
\end{proof}

The payoff for disallowing (run-time) evaluation is to be able to adopt guarded recursion for typed code.
From the logical perspective, it is the deductive form of Gödel-Löb axiom.

\begin{theorem}[Intensional recursion]\label{thm:GL-recursion}
  For every trackable map $f \colon \Box^\kappa X \to X$ tracked by some $F$, there exists a global element of $\Box^\kappa X$ tracked by $F[ \qquote{\mathsf{fix}\,F} ]$.
\end{theorem}
This theorem follows from the Löb induction and the fact that $\mathsf{fix}\,F$ is a fixpoint of $F$
given the Second Recursion Theorem (\Cref{coro:variant-of-SRT}).

\begin{proof}
  Let $f$ be a trackable map from $\Box^\kappa X$ to $X$.
  We prove this statement by Löb induction on a $\sum$-type (\Cref{coro:lob-induction-sum}). 
  That is, assuming 
  \[
    x : \rhd \bproj{X}
    \quad\text{and}\quad
    r : \rhd (\alpha : \kappa).\, F[ \qquote{\mathsf{fix}\,F} ] \Vdash x [\alpha]
  \]
  we derive an inhabitant $y : \bproj{X}$ realised by $F[\qquote{\mathsf{fix}\,F}]$ as follows:
  \begin{enumerate}
    \item First, we have $r' : \rhd (\alpha : \kappa).\, \mathsf{fix}\,F \Vdash x [\alpha]$ since the realisability relation $\Vdash$ respects reductions and $\mathsf{fix}\,F$ reduces to $F[\qquote{\mathsf{fix}\,F}]$. 
    \item Choose $y$ to be $\bproj{f}(\mathsf{fix}\,F, x, r')$ so that we derive
      \[
        s \defeq \mathfrak{f} (\mathsf{refl}_{\twoheadrightarrow}\qquote{\mathsf{fix}\,F}) : F[\qquote{\mathsf{fix}\,F}] \Vdash \bproj{f}(\mathsf{fix}\,F, x, r')
      \]
      by the fact that $F$ tracks $\bproj{f}$ and the realisability $\qquote{\mathsf{fix}\,F} \Vdash_{\Box^\kappa X} (\mathsf{fix}\,F, x, r')$ is just $\qquote{\mathsf{fix}\,F} \reduce \qquote{\mathsf{fix}\,F}$ which holds by reflexivity.
  \end{enumerate}
  By \Cref{lem:global-elemnt}, the pair $y$ and $s$ give rise to a global element of $X$, concluding our proof.
\end{proof}

The deductive form of Gödel-Löb axiom can be internalised as follows.
\begin{theorem}[Gödel-Löb axiom]
  There is a family of maps from $\Box (\Box X \Rightarrow X)$ to $\Box X$ natural in $X$.
\end{theorem}
\begin{proof}
  \ltnote{it should follow from the cartesian closedness}
\end{proof}


\section{Conclusion}\label{sec:conclusion}
We have studied the $\PP$-category of assemblies on untyped $\lambda$-calculus as the foundation of categorical semantics for intensionality in homotopy type theory. 
The additional equality available in $\PP$-categories allows us to bring out intensions as morphisms which is usually not exposed in ordinary categories, since computationally equivalent terms are mostly identified on the semantics side \emph{a priori}.
The situation is likely caused by the confusion between the concept of \emph{denotation} and that of \emph{extension}.
Following the inspiring works by Kavvos we demonstrated further by the definition of~$\boxtimes$ that they are not the same mathematical objects.

Based on the framework established in~\Cref{sec:assemblies}, we subsequently modelled two intensional modalities $\boxtimes$ and $\Box$ satisfying the {\SFour} axiom and the {\GL} axiom respectively to justify the effectiveness of the framework.
As we discussed in \Cref{remark:difference-boxtimes}, $\boxtimes \Nat$ is not $\PP$-isomorphic to $\Nat$ in our case, so what have we modelled is more intensional than what Kavvos has modelled. 
We are also able to justify that the absence of quoting function with our definition, so from the logical perspective $A$ and $\boxtimes A$ are not equivalent for any $A$.
We use a variant of guarded type theories to define the modality~$\Box$ satisfying the Gödel-Löb axiom and its deductive form---the intensional recursion~\cite{Kavvos2017b}---with a notion of computation stages.
This {\GL} modality then answers the question following Theorem~5.38 in the work of Kavvos~\cite{Kavvos2020}.

\subsection{Future work}
The semantics of intensionality is largely an unexplored area.
In the following, we sketch a few immediate questions emerged while working on this paper.

As we have two intensional modalities for the same $\PP$-category~$\ASM(\Lambda)$, one of obvious questions is to find out how these two modalities are related.
It is clear that there is a natural transformation from $\boxtimes$ to $\Box$ deferring computation to the next stage, but we do not know much else about their relationship.
In the context of provability/justification logic, a step taken by Goris~\cite{Goris2009}, where {\SFour} and {\GL} modalities are discussed in a Hilbert-style system, seems relevant to this question.

From the type-theoretic perspective, it is obviously unsatisfactory to have semantics without syntax.
We would like to describe a bi-modal type theory enriched with $\boxtimes$ and $\Box$ based on modal type theories given by Davies and Pfenning~\cite{Davies2001b} and by Kavvos~\cite{Kavvos2017b,Kavvos2020} along with suitable typing rules and operational semantics relating these two modalities hinted by Goris \emph{op.\ cit}.
Following the intuition that $\boxtimes A$ and $\Box A$ are assemblies of $A$-typed code, we expect that this framework can be used to guide the design of language constructs for metaprogramming, an area full of engineering fixes with little mathematical understanding.

From the perspective of logic, our work also sheds a new light on provability logic.
In the field of provability logic, {\SFour} is referred as the modal logic of \emph{explicit} proofs and {\GL} as the modal logic of \emph{implicit} proofs with Kripke semantics.
It is observed by Shamkanov~\cite{Shamkanov2014,Shamkanov2016a} that the {\GL} modality can be realised by circular proofs.
To compare his result with ours, we conjecture that Shamkanov's result is a special case where the quoting function~$\qquote{\cdot}$ is just the identity function with the use of the Second Recursion Theorem replaced by the First Recursion Theorem and $\lambda$-terms interpreted as Böhm trees.

Finally, since one of the main applications of guarded type theory is exactly to give program semantics involving step-indexing~\cite{Birkedal2012}, it might be useful to develop category theory internal to guarded type theory in full detail.
  We expect such a categorical framework would be useful to describe what staged computation is or more generally what metaprogramming is from an abstract point of view.

%If we follow the insight of Davies and Pfenning, then $\boxtimes X$ should be understood as the denotation for the type of typed code.
%As a sanity check, we may further ask the type $\mathsf{Code}$ of \emph{untyped} code and a polymorphic function from $\boxtimes A$ to $\mathsf{Code}$ forgetting what a typed code denotes. 
%This is indeed the case and the point of the following statement.
%\begin{theorem}
%
%  
%\end{theorem}

\bibliographystyle{plainurl}% the mandatory bibstyle
\bibliography{ref}

\appendix


%\section{environments}
%
%\begin{claim}\label{testenv-claim}
%Fusce eu leo nisi. Cras eget orci neque, eleifend dapibus felis. Duis et leo dui. Nam vulputate, velit et laoreet porttitor, quam arcu facilisis dui, sed malesuada risus massa sit amet neque.
%\end{claim}
%
%
%\begin{claimproof}
%Fusce eu leo nisi. Cras eget orci neque, eleifend dapibus felis. Duis et leo dui. Nam vulputate, velit et laoreet porttitor, quam arcu facilisis dui, sed malesuada risus massa sit amet neque.
%\end{claimproof}

\end{document}
