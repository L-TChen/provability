\documentclass[a4paper,UKenglish,numberwithinsect,cleveref,thm-restate]{lipics-v2021}
\usepackage{mathrsfs}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{bussproofs}
\usepackage{xspace}

\usepackage{stmaryrd}
\usepackage{ragged2e}
\usepackage{varwidth}
\newcommand{\den}[2][]{\(\left\llbracket\;\text{#2}\;\right\rrbracket^{#1}\)}

\newcommand{\wraptext}[2][1in]{\begin{varwidth}{#1}{\RaggedRight#2}\end{varwidth}}

% 
\usepackage[draft,noinline,margin]{fixme}
\FXRegisterAuthor{lt}{alt}{LT}
\FXRegisterAuthor{hs}{ahs}{Josh}

%
\newcommand{\eqv}[2]{\ensuremath{#1 \simeq #2}\xspace}

% the following is copied from the HoTT book
\newcommand{\trunc}[2]{\mathopen{}\left\Vert #2\right\Vert_{#1}\mathclose{}}
\newcommand{\ttrunc}[2]{\bigl\Vert #2\bigr\Vert_{#1}}
\newcommand{\Trunc}[2]{\Bigl\Vert #2\Bigr\Vert_{#1}}
\newcommand{\truncf}[1]{\Vert \blank \Vert_{#1}}
\newcommand{\tproj}[3][]{\mathopen{}\left|#3\right|_{#2}^{#1}\mathclose{}}
\newcommand{\tprojf}[2][]{|\blank|_{#2}^{#1}}
\def\pizero{\trunc0}

\newcommand{\brck}[1]{\trunc{}{#1}}
\newcommand{\bbrck}[1]{\ttrunc{}{#1}}
\newcommand{\Brck}[1]{\Trunc{}{#1}}
\newcommand{\bproj}[1]{\tproj{}{#1}}
\newcommand{\bprojf}{\tprojf{}}

\newcommand{\carrier}[1]{\mathopen{}\left|{#1}\right|\mathclose{}}
\newcommand{\barred}[1]{\mathopen{}\left|{#1}\right|\mathclose{}}

\newbox\qqBoxA
\newdimen\qqCornerHgt
\setbox\qqBoxA=\hbox{$\ulcorner$}
\global\qqCornerHgt=\ht\qqBoxA
\newdimen\qqArgHgt
\def\qquote #1{%
    \setbox\qqBoxA=\hbox{$#1$}%
    \qqArgHgt=\ht\qqBoxA%
    \ifnum     \qqArgHgt<\qqCornerHgt \qqArgHgt=0pt%
    \else \advance \qqArgHgt by -\qqCornerHgt%
    \fi \raise\qqArgHgt\hbox{$\ulcorner$} \box\qqBoxA %
    \raise\qqArgHgt\hbox{$\urcorner$}}
%
\newcommand{\Tree}{\mathcal{S}}
\newcommand{\later}{\mathord{\blacktriangleright}}
\newcommand{\laterp}{\mathord{\vartriangleright}}
\newcommand{\PER}{\mathbf{PER}}
\newcommand{\Nat}{\mathbb{N}}
\newcommand{\PP}{\mathscr{P}}
%\newcommand{\Asm}{\mathbf{Asm}}
\newcommand{\Asm}{\mathsf{Asm}}
\newcommand{\ASM}{\mathsf{ASM}}
%\newcommand{\defeq}{\coloneqq}
\newcommand{\defeq}{\vcentcolon\equiv} 
\newcommand{\Univ}{\mathcal{U}}
\newcommand{\comp}{\circ}
\newcommand{\transport}{\mathsf{transport}}
\newcommand{\blank}{{-}}
\newcommand{\id}{\mathsf{id}}
\newcommand{\iid}{\mathit{id}}
\newcommand{\Unit}{\mathbf{1}}
\newcommand{\Empty}{\mathbf{0}}
\newcommand{\pr}{\mathsf{pr}}

\newcommand{\Quote}{\mathtt{quote}}
\newcommand{\Eval}{\mathtt{eval}}
\newcommand{\Subst}{\mathtt{subst}}

\DeclareRobustCommand\longtwoheadrightarrow{\relbar\joinrel\twoheadrightarrow}
\newcommand{\reduce}{\longtwoheadrightarrow_{\beta}}
\newcommand{\onereduce}{\longrightarrow_{\beta}}

\newcommand{\anonymous}{\kern0.06em \vbox{\hrule\@width.5em}}
%
\theoremstyle{plain}
\newtheorem*{notation*}{Notation}

\title{A Realisability Semantics for Gödel-Löb Axiom in Guarded Homotopy Type Theory} 
\author{Liang-Ting Chen}%
  {Institute of Information Science, Academia Sinica, Taiwan~\url{https://l-tchen.github.io}}%
  {liang.ting.chen.tw@gmail.com}%
  {https://orcid.org/0000-0002-3250-1331}{}
\author{Hsiang-Shang Ko}%
  {Institute of Information Science, Academia Sinica, Taiwan~\url{https://josh-hs-ko.github.io}}%
  {joshko@iis.sinica.edu.tw}%
  {https://orcid.org/0000-0002-2439-1048}{}
\authorrunning{L.-T.~Chen and H.-S.~Ko}

\Copyright{Liang-Ting Chen and Hsiang-Shang Ko}
\ccsdesc{Theory of computation~Type theory}
\ccsdesc{Theory of computation~Logic}
\ccsdesc{Theory of computation~Constructive mathematics}
\keywords{Löb's theorem, provability, guarded recursion, realizability, homotopy type theory, modal type theory, metaprogramming}

\relatedversion{} %optional, e.g. full version hosted on arXiv
%\relatedversiondetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93]{Classification (e.g. Full Version, Extended Version, Previous Version}{URL to related version} %linktext and cite are optional

\supplement{The results were formalised in (Guarded) Cubical Agda with source code available at \url{https://github.com/L-TChen/provability}.}

\funding{This work was supported by the Ministry of Science and Technology of Taiwan under grant MOST~109-2222-E-001-002-MY3.}

\acknowledgements{\ltnote{Alex Kavvos, Tsung-Ju Chiang, Rasmus Ejlers Møgelberg, Churn-Jung Liau}}

\nolinenumbers 

%\hideLIPIcs  %uncomment to remove references to LIPIcs series

%Editor-only macros:: begin (do not touch as author)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\EventEditors{John Q. Open and Joan R. Access}
\EventNoEds{2}
\EventLongTitle{42nd Conference on Very Important Topics (CVIT 2016)}
\EventShortTitle{CVIT 2016}
\EventAcronym{CVIT}
\EventYear{2016}
\EventDate{December 24--27, 2016}
\EventLocation{Little Whinging, United Kingdom}
\EventLogo{}
\SeriesVolume{42}
\ArticleNo{23}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\maketitle

\begin{abstract}
  In this paper, we give a positive answer to an open problem posed by Kavvos recently---is there a categorical interpretation of Gödel-Löb axiom~$\Box (\Box A \to A) \to \Box A$ which refutes the completeness principle~$A \to \Box A$?
  We consider the $\PP$-category $\ASM(\Lambda)$ of assemblies on untyped $\lambda$-calculus and trackable maps with an exposure-like construction $\Box\colon \ASM(\Lambda) \looparrowright \ASM(\Lambda)$, internal to a guarded homotopy type theory, as the interpretation of the provability modality~$\Box$.
  We show that $\Box$ refutes the reflection principle $\Box A \to A$ and the completeness principle but models the Gödel-Löb axiom only.
  Of the utmost significance of the interpretation for $\Box A$ is that its denotation involves not only intensions, e.g., derivations of a proof, code of programs, or $\lambda$-terms \emph{modulo $\alpha$-equivalence only} given its provability reading but also their extensions. 
  Apart from its own theoretical interest, following the intuitive interpretation of $\Box A$ as a type of typed code \`a la Davies and Pfenning, our work is a step towards extending type theories on which proof assistants are based with non-structural but guarded recursion on the meta level in a logically consistent way.
\end{abstract}

\section{Introduction}\label{sec:intro}
\cite{Litak2014}
\cite{Davies2001b}

\paragraph*{Contributions}

\paragraph*{Plan of the paper}

\paragraph*{Related work}
\cite{Visser2019,Beklemishev2006}
\cite{Kavvos2017,Kavvos2020}
\cite{Shamkanov2014,Shamkanov2016a}

\section{Preliminaries}\label{sec:preliminaries}

\subsection{Gödel numbering in \texorpdfstring{$\lambda$}{λ}-calculus}
\subsection{Homotopy type theory}
\subsection{Partial equivalence relation and \texorpdfstring{$\PP$}{P}-category}

\section{\texorpdfstring{$\PP$}{P}-category of assemblies on \texorpdfstring{$\lambda$}{λ}-calculus}\label{sec:assemblies}
In this section, we introduce the $\PP$-category of assemblies on $\lambda$-calculus and trackable maps.
Note that this is not just a direct translation from the set-theoretic formulation to homotopy type theory.

\paragraph*{Assembly}
Classically an assembly is a set $|X|$ with a realisability relation $\mathord{\Vdash} \subseteq \mathbb{N} \times |X|$ such that for every $x$ there exists some $a$ with $a \Vdash x$. We say that $a$ \emph{realises} $x$ or $a$ is a \emph{realiser} of $x$ if $n \Vdash x$.
The notion of assemblies is nowadays often defined on an (ordered) partial applicative structure satisfying combinatory completeness, i.e.\ an (ordered) partial combinatory algebra~\cite{Oosten2008}.
Our definition below is, apart from being type-theoretic, not an instance of the general notion.
\begin{definition}\label{def:assembly}
  An \emph{assembly} $X$ on $\lambda$-calculus consists of a \emph{carrier} type $|X| : \Univ$ and a \emph{realisability} relation ${\Vdash_X}$ from $\Lambda_0$ to $|X|$ such that
  \emph{(a)} $M \Vdash_X x$ whenever $M \reduce N$ and $N \Vdash_X x$;
  \emph{(b)} every $x : |X|$ merely has a term $M : \Lambda_0$ with $M \Vdash_X x$. 
  To put it formally, an assembly is an inhabitant $(|X|, \Vdash_X, r_X, t_X)$ of
  \[
    \Asm_0(\Lambda) \defeq \sum_{|X| : \Univ}\;\sum_{\mathord{\Vdash_X}:\Lambda_0 \to |X| \to \Univ} 
    \left(\mathord{\Vdash_X}\;\mathsf{respects}\;\mathord{\reduce}\right)
      \times \mathsf{isRightTotal}({\Vdash_X})
  \]
  where
  \begin{romanenumerate}
    \item $\left(\mathord{\Vdash_X}\;\mathsf{respects}\;\mathord{\reduce}\right)$ is defined as $\prod_{M N : \Lambda_0} \prod_{x : |X|} \left( \left(M \reduce N\right) \to N \Vdash x \to M \Vdash x \right) $, and 
    \item $\mathsf{isRightTotal}(\Vdash_X)$ as $\forall (x : |X|).\, \exists (M : \Lambda_0).\, M \Vdash x$.
  \end{romanenumerate}
\end{definition}
The required properties departs from the conventional definition. 
First, we do not require the realisability relation $\Vdash$ to be a mere proposition (contrary to its topos-theoretic formulation~\cite{Birkedal2002a}).
Although this may simplify many constructions later, we do not find it necessary to impose this condition.
Second, as we would like to account for intensional equality in addition to extensional equality between terms,
we cannot identify $\beta$-equivalent terms \emph{a priori}.
As a result, the interaction with reduction is formulated as an additional property. 
Our formulation is motivated by the confluence of $\lambda$-calculus where every two $\beta$-equivalent terms $M_i$ have a confluent term $N$, i.e.\ $M_i \reduce N$ for $i = 1, 2$.
This formulation also agrees with the one on an ordered partial combinatory algebra~\cite[Section~2.3]{Hofstra2003}.
Third, a plausible alternative to the right totality is
\[
  \prod (x : |X|).\, \sum (M : \Lambda_0).\, M \Vdash x
\]
stating that each $x : |X|$ has an explicit choice of realisers.
This is intuitively not reasonable if, say, $|X|$ is a function type since it amounts to giving a standard implementation in $\lambda$-calculus for any realisable function $f$.
Indeed, with functional extensionality which holds in homotopy type theory, any inhabitant of the alternative formulation leads to a \emph{contradiction}~\cite{Troelstra1977}. \ltnote{check this}

\begin{example}\label{ex:assembly-lambda}
  A useful assembly which plays a significant role in~\Cref{sec:provability} is the type $\Lambda_0$ of closed terms itself with ${\reduce} : \Lambda_0 \to \Lambda_0 \to \Univ$ as its realisability relation.
  Similarly, $r_\Lambda$ and $t_\Lambda$ are given by the transitivity and the reflexivity of~$\reduce$.
  
\end{example}

\begin{example}
  The assembly of natural numbers is also important but not in this paper.
  Nevertheless, we define a realisability relation $\Vdash_{\Nat}$ for natural numbers by
  \[
    M \Vdash_\Nat n \defeq M \reduce \mathtt{c}_n
  \]
  where $\mathtt{c}_n$ is the Church encoding of a natural number $n : \Nat$ with $r_\Nat$ and $t_\Nat$ easy to define. 
\end{example}

\paragraph*{Trackable map}%
Classically, a trackable map is a function $f$ with the property that $f$ is \emph{tracked} by some $b$ in the sense that $a \Vdash x$ implies $b \cdot a \Vdash f\,x$ where the $\cdot$ is the application operation of a partial combinatory algebra. In this case, $b$ is called the \emph{tracker} of $f$.
It is noted by Kavvos~\cite{Kavvos2017b} that to reconcile intensionality on the semantics side we have to consider the tracker as part of structure instead of its mere existence.
\ltnote{explain the difference between property and structure in \Cref{sec:preliminaries}}
\begin{definition}\label{def:trackable}
  Given assemblies $X$ and $Y$, a \emph{trackable map} from $X$ to $Y$ consists of a function $f$ from $|X|$ to $|Y|$ and a term $F : \Lambda_1$ with a free variable $\mathtt{x}$ such that $F[M/\mathtt{x}] \Vdash f\,x$ whenever $M \Vdash x$.
  In other words, a trackable map is an inhabitant of $\Asm_1(X, Y) \defeq \sum_{f : |X| \to |Y|} \sum_{F : \Lambda_1} \mathsf{Tracks}_{X, Y}(F, f)$ where
  \[
    \mathsf{Tracks}_{X, Y}(F, f) \defeq \prod_{M : \Lambda_0} \prod_{x : |X|}
    \left( M \Vdash_X x \to F[M/\mathtt{x}] \Vdash_Y f\, x \right).
  \]
  In the following context, we write $F[M]$ instead of $F[M/\mathtt{x}]$ if there is no danger of confusion since each $F$ has at most one free variable.
\end{definition}
Note that a trackable map is actually a triple $(f, F, \mathfrak{f})$ since $\mathsf{Tracks}_{X, Y}(F, f)$ is not just a mere proposition.

\begin{example}[Identity]
  Every assembly $X$ has a trackable map
  \[
    \iid_X \defeq (\id_{|X|}, \mathtt{x}, \pr_3)
    \quad\text{where}\quad
  \pr_3 \defeq \lambda M.\,\lambda x.\,\lambda r.\, r : \prod_{M : \Lambda_0} \prod_{x : |X|} \left( M \Vdash_X x \to M  \Vdash_X x  \right)
  \]
  since $\mathtt{x}[M]$ is judgementally equal to $M$.
\end{example}
Now we proceed with defining the composition of trackable maps. Consider the term substitution $(G, F)
\mapsto G [ F ]$ and the path $p : G[F[M]] =_{\Lambda_0} G[F] [M]$.
Given $r : M \Vdash_X x$, the type of $\mathfrak{g}(\mathfrak{f}\,r)$ is $G[F[M]]$ and thus its transportation along $p$ has type $G[F][M]$.
This defines an operation $\lambda M.\,\lambda x.\,\lambda r.\, \mathsf{transport}(p, \mathfrak{g}(\mathfrak{f}\,r))$.
Then, it follows that the function composition and aforementioned operations amount to an operation $(g, f) \mapsto g \circ f$ of type
\[
  \prod_{X, Y, Z : \Asm_0(\Lambda)} \Asm_1(Y, Z) \to \Asm_1(X, Y) \to \Asm_1(X, Z)
\]
for trackable maps. It is not hard to see that $f \circ \id = f$ and $\id \circ f = f$ hold propositionally.

\begin{proposition}\label{prop:category-of-assemblies}
  The type $\Asm_0(\Lambda)$ of assemblies and the type of trackable maps from $X$ to $Y$ for each $X$ and $Y$ of type $\Asm_0(\Lambda)$ with the composition $\circ$ for trackable maps and identities $\id$ form a category denoted by $\Asm(\Lambda)$.
\end{proposition}
We may also consider reductions $F_1 \reduce F_2$ between morphisms $(f_1, F_1, \mathfrak{f}_1)$
and $(f_2, F_2, \mathfrak{f}_2)$ as two cells since $F_1 \reduce F_2$ implies $F_1[M] \reduce F_2[M]$.
That is, we do have a $2$-category of assemblies in the spirit of Seely's $2$-categorical model~\cite{Seely1987}.
This line of research is out of scope of this paper, so we refrain ourselves from further discussion. 


\paragraph*{Extensional equality and \texorpdfstring{$\PP$}{P}-category of assemblies}
Now we define the (partial) equivalence relation $\sim$ referred as the \emph{extensional equality} on trackable maps by $(f_1, F_1, \mathfrak{f}_1) \sim (f_2, F_2, \mathfrak{f}_2)$ if $f_1 = f_2$.
It is not hard to see that $\Asm(\Lambda)$ with the extensional equality $\sim$ is a $\PP$-category, denoted by $\ASM(\Lambda)$. 
We now investigate some of its basic properties.

\begin{example}[Terminal object]
  The unit assembly $\top$ is a $\PP$-terminal object defined as $(\Unit, \Vdash_{\Unit}, r_{\Unit}, t_{\Unit})$ where 
  \begin{romanenumerate}
    \item $\Unit$ is the unit type,  
    \item $\Vdash_{\Unit}$ a relation defined by $M \Vdash_{\Unit} \star \defeq M \reduce \mathtt{\lambda x.\, x}$, 
    \item $\quad r_{\Unit}: (M \reduce N) \to (N \reduce L) \to (M \reduce L)$ given by the transitivity of the reduction relation $\reduce$,
    \item and $t_{\Unit}$ the fact that the only inhabitant $\star : \Unit$ has a realiser $\mathtt{\lambda x.\, x}$ (by reflexivity).
  \end{romanenumerate}
  The finality follows from the function extensionality.
\end{example}

It is straightforward but tedious to define the $\PP$-product of assemblies, so we leave this as an exercise to the reader. 
\begin{example}[Initial object]
The empty assembly $\bot$ is $\PP$-initial consisting of the empty type $\Empty$ and a relation $\Vdash_\bot : \Lambda_0 \to \Empty \to \Univ$ given by the elimination rule for the empty type.
The other two components $r_\Empty$ and $t_\Empty$ are trivial.
\end{example}

In addition, one can show that $\bot$ is even a \emph{strict} initial object. That is, 
\begin{proposition}\label{prop:strict-initial}
  Every trackable map $f$ from any assembly $X$ to $\bot$ is an isomorphism. 
\end{proposition}
The strictness of $\bot$ follows easily from that for any type $X$ with a function $X \to \Empty$ one (provably) has the equivalence $\eqv{\Empty}{X}$ in homotopy type theory.
From the strictness of the initial object, no morphism from $\top$ to $\bot$ could exist, since $\top$ is not equivalent to $\bot$.

The construction of exponential $X \Rightarrow Y$ is a bit intriguing.
With the definition of trackable maps, we may expect the exponential assembly $X \Rightarrow Y$ to consist of trackable maps.
However the exponential assembly $X \Rightarrow Y$ has the type of \emph{merely} trackable maps as its carrier following Kavvos' definition~\cite{Kavvos2017c}.  
\begin{example}[Exponentials]
  Given assemblies $X$ and $Y$, define
  \begin{align*}
    \barred{X \Rightarrow Y} & \defeq \sum_{f : |X| \to |Y|} \exists (F : \Lambda_1).\, \mathsf{Tracks}_{X, Y}(F, f) \equiv \sum_{f : |X| \to |Y|} \brck{\sum_{F : \Lambda_1} \mathsf{Tracks}_{X, Y}(F, f) }
  \end{align*}
  with the realisability relation 
  \[
    L \Vdash_{X \Rightarrow Y} (f, \star) \defeq \prod_{M : \Lambda_0} \prod_{x : |X|}\left( M \Vdash_X x \to L\,M \Vdash_Y f\,x\right).
  \]
  It remains to construct $r_{X\Rightarrow Y}$ and $t_{X \Rightarrow Y}$. 
  We know that $L' \reduce L$ implies $L'\,M \reduce L\,M$ by the congruence rule, so $L'$ realises $(f, \star)$ whenever $L$ realises $(f, \star)$ and $L' \reduce L$ by $r_Y$.
  For every $(f, \star) : |X \Rightarrow Y|$, there merely exists a tracker $F$ of $f$.
  We can show that $L \defeq \left(\mathtt{\lambda x}.\,F\right)$ realises $(f, \star)$, since
  $\left(\mathtt{\lambda x}.\,F\right)\,M \onereduce F[M]$ for any $M$ and $F[M] \Vdash_Y f\,x$ whenever $M \Vdash x$
  by that fact that $F$ is a tracker of $f$.
  Then, we apply the recursion principle of the truncated type $\brck{\sum_{F : \Lambda_1} \mathsf{Tracks}_{X, Y}(F, f) }$ on the second component of $(f, \star)$ to show the mere existence of a realiser of $(f, \star)$, i.e.\ an inhabitant $t_{X \Rightarrow Y}$ of the right totality.

  \ltnote{show that $X\Rightarrow Y$ has the required universal property.}
\end{example}

To sum up, we have just showed that $\ASM(\Lambda)$ has a strict initial object, finite products, and exponentials.
That is, 
\begin{corollary}
  $\ASM(\Lambda)$ is a cartesian closed $\PP$-category with a strict initial object.
\end{corollary}
\ltnote{shall we show that $\ASM(\Lambda)$ has a natural number object?}

\section{Realisability semantics for two modalities}\label{sec:provability}

In this section, we first introduce a comonadic exposure $\boxtimes\colon \ASM(\Lambda) \looparrowright \ASM(\Lambda)$ which models a $S4$ modality but different from the exposure $\boxtimes_K$ previously introduced~\cite[Section~9.1]{Kavvos2017b}.
For example, $\boxtimes_K$ preserves finite products including the terminal object~$\top$, but ours does not with good reason. 
Most importantly, we are able to refute the completeness principle $X \to \boxtimes X$ understood as a quoting function from the computational perspective, while we did not find a way to refute it using $\boxtimes_K$.
Hitherto, we finally complete our cook's tour of the previous set-theoretic results based on a partial combinatory algebra in homotopy type theory.

Thereafter, we use an extension of cubical type theory---Ticked Cubical Type Theroy~\cite{Mogelberg2019a}---and introduce an exposure-like construction $\Box$ to model the provability modality.
\ltnote{can we use clocked type theroy to actually prove $\Box$ is an exposure?}
This construction exploits Nakano's later modality so that we can express the intuitve meaning of $\Box X$ cleanly.
We will show that $\Box$ refutes not only the completeness principle by the same argument for $\boxtimes$ but also the reflection principle $\Box X \to X$ which is valid for $\boxtimes$ but logically inconsistent with Gödel-Löb axiom.
Finally, we prove that the main result of this paper: given a trackable map $f : \Box X \to X$ one is able to construct $\top \to \Box X$ using Nakano's guarded recursion on extensions and the Kleene's second recursion theorem on intensions.

\subsection{A comonadic exposure for \texorpdfstring{$\mathsf{S4}$}{S4} modality}
An assembly $X$ records the interplay between intensions, i.e.\ untyped $\lambda$-terms, and extensions, so it is possible to bring out intensions to the level of extensions by pairing $x : \barred{X}$ with a term $M$ which \emph{merely} realises\footnote{%
  We will discuss the mere realisability in~\Cref{sec:conclusion}.
}
$x$ as the carrier of $\boxtimes X$.
A pair $(M, x)$ with $\star : \brck{M \Vdash_X x}$ should be thought as the extension $x$ along with its \emph{extensional} representation~$M$.  
Thus, we argue that $(M, x, \star)$ shall be realised by terms which are $\beta$-equivalent to its Gödel encoding $\qquote{M}$ (instead of $M$ as proposed by Kavvos), since terms $N$ with $N \reduce \qquote{M}$ are \emph{intensional} representations of $M$.
In short, the carrier and the realisability relation are defined as
\[
  \barred{\boxtimes X} \defeq \sum_{M : \Lambda_0} \sum_{x : \barred{X}} \brck{M \Vdash x}
  \quad\text{and}\quad
  N \Vdash_{\boxtimes X} (M, x, \star) \defeq N \reduce \qquote{M}
\]
respectively.
It turns out that $\boxtimes X \defeq (\barred{\boxtimes X}, \Vdash_{\boxtimes X}, r_{\boxtimes X}, t_{\boxtimes X})$ is indeed an assembly where $r_{\boxtimes X}$ and $t_{\boxtimes X}$ are the transitivity and the reflexivity of $\reduce$.

As for the mapping on morphisms, consider a trackable map $(f, F, \mathfrak{f})$ from $X$ to $Y$.
We now define $\boxtimes (f, F, \mathfrak{f}) \defeq (f^\boxtimes, F^\boxtimes, \mathfrak{f}^\boxtimes)\colon \boxtimes X \to \boxtimes Y$ as follows.
Recall that the propositional truncation $\brck{\blank}$ is functorial, so
\[
  f^\boxtimes (M, x, \star) \defeq (F[M], f\,x, \brck{\mathfrak{f}\,M\,x}\,\star)
\]
is a function from $\barred{\boxtimes X}$ to $\barred{\boxtimes Y}$.
To give a tracker of $f^\boxtimes$, recall from \Cref{sec:preliminaries} that there is a term $\mathtt{subst}$ performing term substitution on Gödel numbers, so the term $F^\boxtimes \defeq \mathtt{subst}\,\qquote{F}\,\mathtt{x}$ tracks $f^\boxtimes$ since we have
\begin{align*}
  \left(\mathtt{subst} \,\qquote{F}\,\mathtt{x}\right)[N/\mathtt{x}]
  \equiv  {} & \mathtt{subst}\,\qquote{F}\,N \\
  \reduce {} & \mathtt{subst}\,\qquote{F}\,\qquote{M} \\
  \reduce {} & \qquote{F[M]} \Vdash_{\boxtimes Y} f^\boxtimes(M, x, \star)
\end{align*}
completing the definition of $\mathfrak{f}^\boxtimes$.
In short, $\boxtimes(f, F, \mathfrak{f}) \defeq(f^\boxtimes, F^\boxtimes, \mathfrak{f}^\boxtimes)$ is a trackable map.
\begin{theorem}[{cf.~\cite[Theorem~11]{Kavvos2017b}}]\label{thm:S4-exposure}
  $\boxtimes\colon \ASM(\Lambda) \looparrowright \ASM(\Lambda)$ is a exposure.
  Moreover, $\boxtimes$ has a comonadic structure given by families of trackable maps
  \begin{romanenumerate}
    \item the counit $\epsilon_A \colon \boxtimes X \to X$
    \item the comultiplication $\delta_A \colon \boxtimes X \to \boxtimes \boxtimes X$
  \end{romanenumerate}
  natural in $X$. 
\end{theorem}
\begin{proof}[Proof sketch]
  We only sketch the proof of three less obvious statements here---the preservation of identities and the construction of natural transformations $\epsilon\colon \boxtimes \to \mathcal{I}_{\ASM(\Lambda)}$ and $\delta\colon \boxtimes \to \boxtimes\boxtimes$. 
  To show that $\boxtimes$ preserves identities, we use that fact that the propositional truncation $\brck{\blank}$ is a functor which preserves identities and that $\pr_3$ is a third projection.
  Then, it follows that $\brck{\pr_3\,M\,x} \equiv \brck{\id} = \id$ and thus $\id_{\barred{X}}^\boxtimes (M, x, \star) \equiv (\mathtt{x}[M], x, \brck{\pr_3\,M\,x}\,\star) \equiv \id_{\barred{\boxtimes X}}$.

  For the families of maps $\boxtimes A \to A$ and $\boxtimes A \to \boxtimes \boxtimes A$ natural in $A$, recall from \Cref{sec:preliminaries} that there are terms $\Eval$ and $\Quote$ which evaluates a Gödel number to its representing term and computes the Gödel number $\qquote{N}$ of a given term~$N \equiv \qquote{M}$ in the form of Gödel number respectively. That is, 
  \[
    \mathtt{eval}\,\qquote{M} \reduce M
    \quad\text{and}\quad
    \mathtt{quote}\,\qquote{M} \reduce \qquote{\qquote{M}}.
  \]
It is now straightforward to define the required natural transformations between exposures.
\end{proof}
In particular, the counit $\epsilon_X\colon \Box X \to X$ is understood as the evaluation of the intension $M$ to its extension~$x$, as justified by the its tracker~$\mathtt{eval}$. 

\ltnote{$\boxtimes$ is not cartesian and not product-preserving.}

The following theorem is another significant difference between $\boxtimes_K$ and $\boxtimes$.\ltnote{can $\mathcal{I} \to \boxtimes_K$ be refutable?}
\begin{theorem}\label{thm:S4-no-quoting}
  There is no natural transformation $\eta\colon  \mathcal{I}_{\ASM(\Lambda)} \to \boxtimes$.
\end{theorem}
We show the existence of such a natural transformation implies the existence of a term $\mathsf{quote}'$ with $\mathsf{quote}'[M] \reduce \qquote{M}$ using naturality and the fact that $\Lambda_0$ itself has naturally an assembly structure (\Cref{ex:assembly-lambda}), but however $\Quote'$ cannot exist.
\begin{proof}
  Assume that such a family of maps $\eta_X\colon X \to \boxtimes X$ natural in $X$ exist.
  Every closed term $M_0$ corresponds to a trackable map $\widehat{M_0} \defeq (\mathsf{c}_{M_0}, M_0, \mathfrak{M}_0) \colon \top \to \Lambda$ where $\mathsf{c}_{M_0}$ is the constant function with the value $M_0$ and $\mathfrak{M}_0$ is also the constant function with the value $\mathsf{refl}_{\twoheadrightarrow} M_0 : M_0 \reduce M_0$.
  Consider the naturality of $\eta$
  \[
    \xymatrix{
      \top \ar[r]^{\eta_\top} \ar[d]_{\widehat{M_0}} & \boxtimes \ar[d]^{\boxtimes \widehat{M_0}} \top \\
      \Lambda \ar[r]_{\eta_\Lambda} & \boxtimes \Lambda
    }
  \]
  which commutes up to $\sim$, namely, ${\eta_\Lambda \circ \widehat{M_0}} \sim {\boxtimes \widehat{M_0} \circ \eta_\top}$.
  Note that $\boxtimes \widehat{M_0}$ maps arbitrary inhabitant of $\boxtimes \top$ to $(M_0, M_0, \bproj{\mathsf{refl}_{\twoheadrightarrow}M_0})$ so that $\bproj{\eta}$ must satisfy 
\[
  \bproj{\eta_\Lambda}\,M_0 \equiv \left(\bproj{\eta_\Lambda} \circ \widehat{M_0}\right)\,\star = \left(\boxtimes \widehat{M_0} \circ \eta_\top \right)\,\star \equiv (M_0, M_0, \bproj{\mathsf{refl}_{\twoheadrightarrow}M_0}).
\]
By assumption, $\eta_\Lambda$ is tracked by some term, say $\mathtt{quote}'$, such that $\mathtt{quote}'[N] \reduce \qquote{M}$ whenever $N \reduce M$.
However, it implies that $\mathtt{quote}'[M] \reduce \qquote{M}$ for any $M$, a contraction.
\end{proof}

\begin{remark}\label{remark:S4-modality}
Recall the modal type theory considered by Davies and Pfenning~\cite{Davies2001b} where a dual-context modal type theory is introduced to extend simple type theory with a $S4$ modality $\Box$, a construct $\mathtt{box}$, a $\mathtt{let}$-expression for boxed terms, and typing rules below.
\[
\begin{minipage}{.45\linewidth}
  \begin{prooftree}
    \AxiomC{$\Delta; \cdot \vdash E : A$}
    \UnaryInfC{$\Delta; \Gamma \vdash \mathtt{box}\,E:\Box A$}
  \end{prooftree}
\end{minipage}%
\begin{minipage}{0.45\linewidth}
  \begin{prooftree}
    \AxiomC{$\Delta; \Gamma \vdash E_1 : \Box A$}
    \AxiomC{$\Delta, u : A; \Gamma \vdash E_2 : B$}
  \BinaryInfC{$\Delta; \Gamma \vdash \mathtt{let}\,\mathtt{box}\, u = E_1\, \mathtt{in}\,E_2 : B$}
  \end{prooftree}
\end{minipage}
\]
Following \Cref{thm:S4-exposure,thm:S4-no-quoting}, we anticipate an interpretation of $\Box$ to justify the `omitted congruence rule` for the $\mathtt{box}$ construct~\cite[Section~2.5]{Davies2001b} and no quoting function $A \to \Box A$ for their system respectively.
\end{remark}

\subsection{An exposure for \texorpdfstring{$\mathsf{GL}$}{GL} modality}
It is known that the Gödel-Löb axiom $\Box(\Box A \to A) \to \Box A$ is incompatible with the reflection principle $\Box A \to A$.
Indeed, let $A$ be the falsity $\bot$ for both laws. Then, we have
\[
  \Box(\Box \bot \to \bot) \to \bot
  \quad\text{and}\quad
  \Box \bot \to \bot
\]
By the necessitation rule and modus ponens, $\Box (\Box \bot \to \bot)$ as well as $\bot$ are derivable.
Yet, by \Cref{prop:strict-initial,thm:S4-exposure}, we cannot expect the exposure $\boxtimes$ to model the Gödel-Löb axiom.
Mysteriously, the provability modality $\Box$ and the Gödel-Löb axiom are suggested to be understood also as the type of code of type~$A$ (cf.~\Cref{remark:S4-modality}) and as \emph{intensional recursion} respectively from the computational perspective~\cite{Kavvos2017b}, if one gives up logical consistency.
This trade-off, however, is not possible in this semantics approach.

To untie the knot but to retain the logical consistency and the intuition of $\Box A$ as $A$-typed code, we refine our informal understanding by their computation stages. 
Considering the counit $\epsilon_X\colon \boxtimes X \to X$, it is possible to evaluate $(M, x, \star)$ because the code is already available for doing so.
And, the provability reading of $\Box$ suggests that inhabitants of $\Box X$ are not available now but in the later stage.
To express this idea cleanly, we work in an extension of homotopy type theory with the support of Nakano's later modality~\cite{Nakano2000}.

\paragraph*{Digression: Ticked Cubical Type Theory}

\cite{Mogelberg2019a,Veltri2020}

\paragraph*{Back to \texorpdfstring{$\mathsf{GL}$}{GL}}

Now we are able to formally introduce (the carrier of) the $\mathsf{GL}$ modality at $X$ as
\[
  \bproj{\Box X} \defeq \sum_{M : \Lambda_0} \sum_{x : {\rhd (\alpha : \mathbb{T}) \bproj{X}}} \rhd (\alpha : \mathbb{T}) .\, \brck{M \Vdash_X x [\alpha]}
\]
with the same realisability relation $\Vdash_{\Box X}$ defined by $N \Vdash_{\Box X} (M, x, \star) \defeq N \reduce \qquote{M}$. 


\begin{theorem}\label{thm:GL-no-quoting}
  There is no natural transformation $\eta\colon  \mathcal{I}_{\ASM(\Lambda)} \to \Box$.
\end{theorem}

\begin{theorem}\label{thm:GL-no-eval}
  There is no natural transformation $\eta\colon \Box \to \mathcal{I}_{\ASM(\Lambda)}$.
\end{theorem}

\begin{theorem}\label{thm:GL-recursion}
  For any trackable map $\Box X \to X$ there is an inhabitant of $\Box X$.
\end{theorem}


\section{Conclusion}\label{sec:conclusion}
\paragraph*{Future work}
\begin{enumerate}
  \item \Cref{remark:S4-modality}, \cite{Davies2001b}, \cite{Kavvos2020}
  \item topos-theoretic arguments
  \item Mix with \cite{Kavvos2017b}
  \item Consistent version of \cite{Kavvos2017b}
  \item Compare this with \cite{Shamkanov2014} and \cite{Shamkanov2016a}.
\end{enumerate}
\cite{Davies2001b}
%%
%% Bibliography
%%

\bibliographystyle{plainurl}% the mandatory bibstyle
\bibliography{../../library_fixed}

\appendix


%\section{environments}
%
%\begin{claim}\label{testenv-claim}
%Fusce eu leo nisi. Cras eget orci neque, eleifend dapibus felis. Duis et leo dui. Nam vulputate, velit et laoreet porttitor, quam arcu facilisis dui, sed malesuada risus massa sit amet neque.
%\end{claim}
%
%
%\begin{claimproof}
%Fusce eu leo nisi. Cras eget orci neque, eleifend dapibus felis. Duis et leo dui. Nam vulputate, velit et laoreet porttitor, quam arcu facilisis dui, sed malesuada risus massa sit amet neque.
%\end{claimproof}

\end{document}
