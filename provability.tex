\documentclass[a4paper,UKenglish,numberwithinsect,cleveref,thm-restate]{lipics-v2021}
\numberwithin{equation}{section}

\usepackage{mathrsfs}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{bussproofs}
\usepackage{xspace}

%\usepackage{stmaryrd}
\usepackage{ragged2e}
\usepackage{varwidth}

% 
\usepackage[draft,noinline,margin]{fixme}
\FXRegisterAuthor{lt}{alt}{LT}
\FXRegisterAuthor{hs}{ahs}{Josh}

\input{macros.tex}
%
\theoremstyle{plain}
\newtheorem*{notation*}{Notation}

\title{Realising Intensional \SFour and \GL Modalities} 
\author{Liang-Ting Chen}%
  {Institute of Information Science, Academia Sinica, Taiwan~\url{https://l-tchen.github.io}}%
  {liang.ting.chen.tw@gmail.com}%
  {https://orcid.org/0000-0002-3250-1331}{}
\author{Hsiang-Shang Ko}%
  {Institute of Information Science, Academia Sinica, Taiwan~\url{https://josh-hs-ko.github.io}}%
  {joshko@iis.sinica.edu.tw}%
  {https://orcid.org/0000-0002-2439-1048}{}
%\author{Tsung-Ju Chiang}%
%  {Institute of Information Science, Academia Sinica, Taiwan}%
%  {tsungju@pm.me}%
%  {}{}
\authorrunning{L.-T.~Chen and H.-S.~Ko}

\Copyright{Liang-Ting Chen and Hsiang-Shang Ko}
\ccsdesc{Theory of computation~Type theory}
\ccsdesc{Theory of computation~Logic}
\ccsdesc{Theory of computation~Constructive mathematics}
\keywords{Löb's theorem, provability, guarded recursion, realizability, homotopy type theory, modal type theory, metaprogramming}

\relatedversion{} %optional, e.g. full version hosted on arXiv
%\relatedversiondetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93]{Classification (e.g. Full Version, Extended Version, Previous Version}{URL to related version} %linktext and cite are optional

\supplement{The results were formalised in (Guarded) Cubical Agda with source code available at \url{https://github.com/L-TChen/provability}.}

\funding{This work was supported by the Ministry of Science and Technology of Taiwan under grant MOST~109-2222-E-001-002-MY3.}

\acknowledgements{\ltnote{Alex Kavvos,, Rasmus Ejlers Møgelberg, Churn-Jung Liau, Zulip@HoTT, Zulip@Agda}}

\nolinenumbers 

%\hideLIPIcs  %uncomment to remove references to LIPIcs series

%Editor-only macros:: begin (do not touch as author)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\EventEditors{John Q. Open and Joan R. Access}
\EventNoEds{2}
\EventLongTitle{42nd Conference on Important Topics (CIT 2016)}
\EventShortTitle{CIT 2016}
\EventAcronym{CVIT}
\EventYear{2016}
\EventDate{December 24--27, 2016}
\EventLocation{Little Whinging, United Kingdom}
\EventLogo{}
\SeriesVolume{42}
\ArticleNo{23}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\maketitle

\begin{abstract}
  \ltnote{not super happy with the abstract; rewrite it}
  In this paper, we give a positive answer to a recent open problem---is there a categorical interpretation of the Gödel-Löb axiom~$\Box (\Box A \to A) \to \Box A$ which refutes the completeness principle $A \to \Box A$?

  We consider the $\PP$-category $\Asm(\Lambda)$ of assemblies on untyped $\lambda$-calculus and trackable maps with an exposure-like construction $\Box\colon \Asm(\Lambda) \looparrowright \Asm(\Lambda)$, internal to a guarded homotopy type theory, as the interpretation of the provability modality~$\Box$.
  We show that $\Box$ refutes the reflection principle $\Box A \to A$ and the completeness principle but proves the Gödel-Löb axiom.
  Of the utmost significance of the interpretation for $\Box A$ is that its denotation involves not only intensions, e.g., derivations of a proof, code of programs, or $\lambda$-terms modulo $\alpha$-equivalence given its provability reading but also their extensions enriched with a notion of computation stages. 

  Following the understanding of $\Box A$ as a type of typed code \`a la Davies and Pfenning, our work is a step towards extending type theories on which proof assistants are based with non-structural but guarded recursion for typed code while maintaining consistency.
\end{abstract}

\section{Introduction}\label{sec:intro}
\cite{Litak2014,Davies2001b}

\paragraph*{Contributions}
\ltnote{intensional modality?}

\paragraph*{Plan of the paper}
\Cref{sec:preliminaries}
\Cref{sec:assemblies}
\Cref{sec:provability}
\Cref{sec:conclusion}

\paragraph*{Related work}
\cite{Visser2019,Beklemishev2006}
\cite{Kavvos2020}
\cite{Shamkanov2014,Shamkanov2016a}

\section{Preliminaries}\label{sec:preliminaries}
This work is based on untyped $\lambda$-calculus~\cite{Barendregt1984a}, homotopy type theory~\cite{hottbook}, and $\PP$-categories~\cite{Cubric1998a}, which will be recalled in the rest of this section.
Most, if not all, of the materials are standard, so readers comfortable with the aforementioned subjects should feel free to skip this section.

\subsection{Homotopy type theory}
We highlight the main difference between set theory and homotopy type theory.
\ltnote{(mere) proposition, set, structure vs.\ property, $n$-types are closed under $\sum$, $\prod$-type formers, \setU, \propU, function extensionality, decidable type}
\begin{theorem}[Hedberg]
  If $X$ has decidable quality, then $X$ is a set.
\end{theorem}

\subsection{\texorpdfstring{$\lambda$}{λ}-calculus}
For $\lambda$-calculus, we fix notations and state a few of its properties in homotopy type theory.
Most of details can be found in the classic textbook by Barendregt~\cite{Barendregt1984a}.

Terms are defined informally by
\[
  M \defeq \mathtt{x} \mid M\,N \mid \lambda \mathtt{x}.\, M
\]
where variables $\mathtt{x}$ are in the typewriter font.
$\Lambda$ denotes the type of terms and $\Lambda_n$ the type of terms with at most $n$ free variables.
In particular, $\Lambda_0$ is the type of \emph{closed terms}.
By using the de Bruijn representation, $\alpha$-equivalent terms are identified, so the $\alpha$-equivalence~$=_\alpha$ coincides with the identity type~$=_\Lambda$ by construction, and likewise for $F : \Lambda_{n+1}$ we write $F[M]$ instead of $F[M/\mathtt{x_0}]$ for substitution for the variable of index~$0$.
The set~$M \reduce N$ of reductions from $M$ to $N$ consists of sequences of reduction rules such as $\beta : (\lambda \mathtt{x}.\,M)\,N \onereduce M [ N / \mathtt{x} ]$.
The set $M \reduce M$ has an exactly one inhabitant---the empty sequence understood as (the proof of) the reflexivity~$\refl_\twoheadrightarrow M$, or just $\refl_\twoheadrightarrow$.
The type $\Lambda$ of terms has decidable equality as well as $M \reduce N$, so they are sets by Hedberg's theorem.

\subsubsection{Gödel encoding and the Second Recursion Theorem}\label{subsec:godel}
In $\lambda$-calculus there is a function between $\lambda$-terms
  $\qquote{\cdot} : \Lambda \to \Lambda_0$
mapping any term $M$ to a closed term $\qquote{M}$ such that $\qquote{M}$ is normal and
$M \equiv_\alpha N$ whenever $\qquote{M} \equiv_\alpha \qquote{N}$.
Moreover there are terms $\mathtt{ap}$, $\mathtt{subst} \in \Lambda_2$ and $\mathtt{quote}$, $\mathtt{eval} \in \Lambda_1$ satisfying

\begin{align*}
  \mathtt{ap}[\,\qquote{M}\,][\,\qquote{N}\,] & \reduce \qquote{M\,N}
                                                                & \mathtt{subst}[\,\qquote{F}\,][\,\qquote{N}\,] & \reduce \qquote{F[N]} \\
  \mathtt{quote}[\,\qquote{M}\,] & \reduce \qquote{\qquote{M}}         
                                                     & \mathtt{eval}[\,\qquote{M}\,] & \reduce M.
\end{align*}
This function $\qquote{\cdot}$ is called a \emph{Gödel encoding}.
By convention a quoted term $\qquote{M}$ is called a Gödel \emph{number} since the encoding function $\qquote{\cdot}$ is defined by assigning a natural number $\#M$ represented as a Church numeral $\mathbf{c}_{\#M}$ to every term~$M$, a method invented by Gödel to prove the incompleteness theorems.
By nature it does not have to be a number at all, so we refrain from calling $\qquote{M}$ a number. 
Instead, $\qquote{M}$ is simply called a \emph{code} of $M$. 
For details on the axiomatic characterisation of encoding, see Polonsky~\cite{Polonsky2011}.

Note that the term $\mathtt{quote}$ can only compute the code of a term $\qquote{M}$ already in a quoted form.
Indeed, no such term can compute the code of any arbitrary term.
\begin{proposition}\label{prop:no-quoting}
  There is no $\mathtt{Q} : \Lambda_1$ such that $\mathtt{Q}[M] \reduce \qquote{M}$ for any $M : \Lambda$.
\end{proposition}
\begin{proof}
  Assume such a term $\mathtt{Q}$ exists. 
  Consider $\mathtt{I} \defeq \mathtt{\lambda x.\, x}$ and $\mathtt{I}\,\mathtt{I}$. 
  We have $\mathtt{Q}[\mathtt{I}\,\mathtt{I}] \reduce \qquote{\mathtt{I}\,\mathtt{I}}$ by assumption but also $\mathtt{Q}[\mathtt{I}\,\mathtt{I}] \reduce \mathtt{Q}[\mathtt{I}]\reduce \qquote{I}$.
  Hence, by confluence and the assumption that $\qquote{M}$ is normal for any $M$, it follows that $\qquote{I\,I} \equiv_\alpha \qquote{I}$ and thus $\mathtt{I\,I} \equiv_\alpha \mathtt{I}$, a contradiction.
\end{proof}
\hsnote{revise}

Contrary to the well-known Kleene's first recursion theorem, his second recursion theorem which works for \emph{code} is lesser known but far more interesting for our purpose.

\begin{theorem}[Second Recursion Theorem] \label{thm:SRT}
  Every term $F : \Lambda$ has a closed term $M$ with $M \reduce F\,\qquote{M}$.
  In particular every $F : \Lambda_1$ has $\mathsf{fix}\,F : \Lambda_0$ satisfying $\mathsf{fix}\,F \reduce F[\,\qquote{\mathsf{fix}\,F}\,]$.
\end{theorem}

\subsection{\texorpdfstring{$\PP$}{P}-Categories and exposures}
Instead of ordinary categories, we work with $\PP$-categories as pioneered by \v{C}ubri\'c et al.~\cite{Cubric1998a} to study normalisation in typed $\lambda$-calculus.
Their use was recently advocated by Kavvos~\cite{Kavvos2017b}, who introduced a functor-like concept called \emph{exposure} exemplified by the Second Recursion Theorem and more in the realm of computability theory.
\hsnote{doesn’t really help with understanding what exposures are about}

We sketch the main idea of the works by \v{C}ubri\'c et al.\ and by Kavvos \emph{op.\ cit.} as follows.
\begin{definition}
  A \emph{partial equivalence relation} is a symmetric and transitive relation.
  A \emph{$\PP$-set} $(X, \sim_X)$ is a set $X$ with a partial equivalence relation~$\sim_X$.
  A \emph{$\PP$-function} from $(X, \sim_X)$ to $(Y, \sim_Y)$ is a function $f\colon X \to Y$ which respects the relation~$\sim$ in the sense that $f\,x \sim_Y f\,y$ whenever $x \sim_X y$.
  An element $x \in X$ is \emph{well-defined} (with respect to $\sim$) if $x \sim x$.
\end{definition}
The identity function $\idfunc[X] : X \to X$ is a $\PP$-function, and the composite of two $\PP$-functions is again a $\PP$-function.
It turns out that $\PP$-sets and $\PP$-functions form a cartesian closed category~$\PP\text{-}\mathbf{Set}$, so by enriched category theory~\cite{Kelly1982} we have a notion of categories enriched by $\PP$-sets below.

\begin{definition}[{\cite[Definition~2.4]{Cubric1998a}}]
  A $\PP$-category is a category whose hom-sets are $\PP$-sets satisfying the associativity and identity laws up to~$\sim$ in the sense that 
  \begin{romanenumerate}
  \item every object~$X$ has an identity morphism $\iid_X$, 
  \item $g \circ f \sim g' \circ f'$ whenever $g\sim g'$ and $f \sim f'$,
  \item $\iid \circ f \sim f'$ and $f \circ \iid \sim f'$ whenever $f \sim f'$,
  \item $h \circ (g \circ f) \sim (h' \circ g') \circ f'$ whenever $h\sim h'$, $g \sim g'$, and $f \sim f'$.
  \end{romanenumerate}
\end{definition}

A $\PP$-category has two kinds of equality for morphisms---the underlying identity $=$ and the partial equivalence relation $\sim$, where the former is considered as the \emph{intensional equality} and the latter as the \emph{extensional equality} akin to the modal type theory by Pfenning~\cite{Pfenning2002a}.
Having two different equalities $=$~and~$\sim$ reflects the fact that, for example, $\alpha$-equivalent terms are $\beta$-equivalent but not vice versa.
For categorical semantics, where terms are interpreted as morphisms, an interpretation into a $\PP$-category is able to discriminate these two kinds of equality, enabling us to model intensionality.
The usual categorical notions such as functors and initiality are up to the intensional equality~$=$\,; when we want to use the notions up to the extensional equality~$\sim$, we will add the `$\PP$-' prefix and say $\PP$-functors, $\PP$-initiality, etc.

We recall the notion of exposures, which are like ($\PP$-)functors but are intended to `expose' intensional differences at the extensional level: when an exposure is applied to intensionally different morphisms (which may be identified up to the extensional $\sim$-equality in the source $\PP$-category), the resulting morphisms may be distinguished extensionally in the target $\PP$-category.
Consequently, exposures are not required to preserve $\sim$-equality.
Moreover, exposures are only supposed to refine the extensional equality and do not eliminate existing extensional differences---that is, they are faithful with respect to~$\sim$.
The precise definition is as follows.

\begin{definition}
  Given $\PP$-categories $\mathbf{C}$ and $\mathbf{D}$, an \emph{exposure} $Q\colon \mathbf{C} \looparrowright \mathbf{D}$ consists of \emph{(a)} a mapping $Q$ from objects $X$ of\/ $\mathbf{C}$ to objects~$QX$ of\/ $\mathbf{D}$ and \emph{(b)} from well-defined morphisms $f\colon X \to Y$ to well-defined morphisms $Qf\colon QX \to QY$ satisfying the following properties:
  \begin{romanenumerate}
    \item $Q\iid_X \sim \iid_{QX}$,
    \item $Q(g \circ f) \sim Qg \circ Qf$, and
    \item $f \sim g$ whenever $Qf \sim Qg$ for any two well-defined morphisms $f, g\colon X \to Y$. 
  \end{romanenumerate}
\end{definition}


The \emph{identity exposure} $\mathcal{I}$ maps every object or morphism to itself.
Composing two exposures in the usual way clearly gives us an exposure. 

Similarly, the notion of natural transformations is introduced for exposures which shares the same idea of the ordinary natural transformation but up to~$\sim$.
\begin{definition}
  Given exposures $P, Q\colon \mathbf{C} \looparrowright \mathbf{D}$, a \emph{natural transformation of exposures} $t\colon P \to Q$ is a family of well-defined morphisms $t_X \colon PX \to QX$ such that $Qf \circ t_X \sim t_Y \circ Pf$ for every well-defined morphism~$f\colon X \to Y$. 
\end{definition}
An \emph{evaluator} for an endo-exposure~$Q$ is a natural transformation from $Q$ to $\mathcal{I}$.

To model the \SFour modality, we may further define the notion of comonadic exposures introduced by Kavvos~\cite{Kavvos2017b} as an endo-exposure equipped with an evaluator and a natural transformation~$\delta$ from $Q$ to $Q^2$ (where each component $\delta_X$ additionally needs to model $Q$-quotation properly) subject to comonad laws.
In our framework, however, we would have to adopt \emph{lax} natural transformations for the comultiplication, where the naturality holds only up to $\reduce$.
We will revisit this issue in~\Cref{sec:provability}.

\section{\texorpdfstring{$\PP$}{P}-Category of assemblies on \texorpdfstring{$\lambda$}{λ}-calculus}\label{sec:assemblies}

In this section, we introduce the $\PP$-category of assemblies on $\lambda$-calculus and trackable maps.
Assemblies are used to accommodate the information of how extensions are related to, or \emph{realised by}, intensions. Accordingly an appropriate notion of morphisms between assemblies is introduced to form a $\PP$-category, laying
the technical foundation for~\Cref{sec:provability}.


\subsection{Assembly}
Traditionally, an assembly on natural numbers is a set $\bproj{X}$ with a realisability relation $\mathord{\Vdash} \subseteq \mathbb{N} \times |X|$ such that for every $x$ in $\bproj{X}$ there exists some $a$ with $a \Vdash x$.
We say that $a$ \emph{realises} $x$ or $a$ is a \emph{realiser} of $x$ if $a \Vdash x$.
The notion of assemblies is nowadays often defined on a partial applicative structure $(A, \cdot)$ satisfying combinatory completeness~\cite{Oosten2008}, i.e.\ a partial combinatory algebra, \emph{PCA} for short.
Our definition below is more akin to but not an instance of the definition based on an ordered PCA~\cite{Hofstra2003}.
\hsnote{A bit of comparison here}
\begin{definition}\label{def:assembly}
  An \emph{assembly} $X$ on $\lambda$-calculus consists of a \emph{carrier} set $|X| : \setU$ and a family ${\Vdash_X}$ of sets indexed by $\Lambda_0$ to $|X|$ as its \emph{realisability relation} such that
  \emph{(a)} there is merely a realiser $M : \Lambda_0$ of every $x : \bproj{X}$, and
  \emph{(b)} $M \Vdash_X x$ whenever $M \reduce N$ and $N \Vdash_X x$.
  That is, an assembly is a quadruple $(|X|, \Vdash_X, r_X, t_X)$ of type
  \[
    \Asm_0(\Lambda) \defeq \sm{\bproj{X} : {\setU}}{\mathord{\Vdash_X}:\Lambda_0 \to |X| \to \setU} 
      \mathsf{Respects}\left(\Vdash_X, \mathord{\twoheadrightarrow_\beta}\right)
      \times \mathsf{RightTotal}({\Vdash_X})
  \]
  where
  \begin{align}
    \mathsf{Respects}\left(\mathord{\Vdash_X}, \mathord{\twoheadrightarrow_\beta}\right) & \defeq\prd{M N : \Lambda_0}{x : |X|} \left(M \twoheadrightarrow_ \beta N\right) \to \left(N \Vdash x\right) \to \left(M \Vdash x\right) \label{eq:respect-reduction} \\      
    \mathsf{RightTotal}(\Vdash_X) & \defeq \fall{x : |X|}\exis{M : \Lambda_0} M \Vdash x
    \label{eq:right-total}
  \end{align}
\end{definition}

Regarding our type-theoretic formulation, there are at least two aspects worthy of some discussion.
First, as we would like to account for intensional equality in addition to extensional equality between terms,
computationally equivalent terms should not be identified \emph{a priori}.
It turns out that formulating the interaction with reduction $\reduce$ as~\eqref{eq:respect-reduction} in line with the definition on an ordered PCA suffices to derive properties akin to classic results.
%The formulation $\left(\mathord{\Vdash_X}\;\mathsf{respects}\;\mathord{\twoheadrightarrow_\beta}\right)$ is motivated by the confluence of $\lambda$-calculus where every two $\beta$-equivalent terms $M_i$ have a confluent term $N$, i.e.\ $M_i \reduce N$ for $i = 1, 2$.
Second, a plausible alternative to the right totality~\eqref{eq:right-total} one might expect is
\begin{equation}\label{eq:alternative-right-totality}
  \lprd{x : |X|} \lsm{M : \Lambda_0} M \Vdash x
\end{equation}
stating that each inhabitant $x : |X|$ has a choice of realisers.
However, with function extensionality valid in HoTT, the alternative type~\eqref{eq:alternative-right-totality} is in fact empty considering, say, $\lambda$-definable functions between natural numbers by Troelstra~\cite{Troelstra1977}.
\ltnote{Prove this formally}

\begin{example}\label{ex:assembly-lambda}
  The type $\Lambda_0$ of closed terms with the reduction relation ${\reduce}$ as its realisability relation is an assembly $(\Lambda_0, \reduce, r_\Lambda, t_\Lambda)$ where $r_\Lambda$ and $t_\Lambda$ are given by the transitivity and the reflexivity of~$\reduce$.
\end{example}

\begin{example} \label{ex:assembly-naturals}
  Every natural number $n : \Nat$ is realised by its Church numeral~$\mathtt{c}_n$.
  That is, the type $\Nat$ of natural numbers with the realisability relation $\Vdash_{\Nat}$ defined by
  \[
    \left(M \Vdash_\Nat n\right) \defeq \left(M \reduce \mathtt{c}_n\right)
  \]
  is an assembly where $r_\Nat$ and $t_\Nat$ are given by the transitivity and the reflexivity of~$\reduce$.
\end{example}

\subsection{Trackable map}%

A morphism between assemblies on a PCA $(A, \cdot)$ is defined as a function~$f$ merely \emph{tracked by} some $b \in A$ in the sense that there merely exists some $b$ such that $b \cdot a \Vdash f\,x$ whenever $a \Vdash x$.
In this case, $b$ is called the \emph{tracker} of $f$.
It is noted by Kavvos~\cite{Kavvos2017b} that to reconcile intensionality the tracker should be considered as part of the structure instead of a property.
\hsnote{change `reconcile' to `reveal'? `express'?}
\begin{definition}\label{def:trackable}
  Given assemblies $X$ and $Y$, a \emph{trackable map} from $X$ to $Y$ consists of a function $\bproj{f}$ from $|X|$ to $|Y|$ and a term $F : \Lambda_1$ such that $F[M] \Vdash \bproj{f}\,x$ if $M \Vdash x$.
  In other words, the type $\Asm_1(X, Y)$ of trackable maps is $\sum_{\bproj{f} : |X| \to |Y|} \sum_{F : \Lambda_1} \mathsf{Tracks}_{X, Y}(F, \bproj{f})$ where
  \[
    \mathsf{Tracks}_{X, Y}(F, \bproj{f}) \defeq \prd{M : \Lambda_0}{x : |X|}
    \left(M \Vdash_X x\right) \to \left(F[M] \Vdash_Y \bproj{f}\, x\right).
  \]
  A \emph{merely trackable map} is an inhabitant of $\sm{\bproj{f} : |X| \to |Y|} \exis{F : \Lambda_1}\mathsf{Tracks}_{X, Y}(F, \bproj{f})$. 
\end{definition}

By definition, a trackable map $f$ consists of not only a function $\bproj{f}$ between carriers but also its tracker $F$ and a transformation $\mathfrak{f}$ for realisability.

\begin{example}[Identity]
  Every assembly $X$ has a trackable map $\iid_X \defeq (\idfunc[\bproj{X}], \mathtt{x}, \pr_3)$
  where
  \[
    \pr_3 \defeq \lam{M}{x}{r} r : \prd{M : \Lambda_0}{x : |X|} \left(M \Vdash_X x\right) \to \left(M  \Vdash_X x\right)
  \]
  since $\mathtt{x}[M]$ is judgementally equal to $M$.
\end{example}

Now we proceed with defining the composition of trackable maps. Let $f\colon X \to Y$ and $g\colon Y \to Z$ be trackable maps.
Then, the term substitution $(G, F) \mapsto G [ F ]$ can be thought as (intensional) function composition, since $G[F[M]] =_{\Lambda_0} G[F] [M]$ holds for any term $M$.
Given any $r : M \Vdash_X x$, the inhabitant $\mathfrak{g}(\mathfrak{f}\,r)$ is of type $G[F[M]]$ and its transportation along any witness $p : G[F[M]] =_{\Lambda_0} G[F][M]$ is of type $G[F][M]$, defining a function $\lambda M\,x\,r.\, \mathsf{transport}(p, \mathfrak{g}(\mathfrak{f}\,r))$.
Therefore, the above discussion amounts to defining an operation $(g, f) \mapsto g \circ f$ of type
\[
  \Asm_1(Y, Z) \to \Asm_1(X, Y) \to \Asm_1(X, Z).
\]

Then, it is not hard but tedious and laborious to prove that the assemblies and trackable map form an ordinary category.
However, as we are only concerned about $\PP$-categories, we do not elaborate details here.

%\begin{proposition}\label{prop:category-of-assemblies}
%  The type $\ASM_0(\Lambda)$ of assemblies and the family of types $\ASM_1(X, Y)$ of trackable maps form a category.
%\end{proposition}

%We may also consider reductions $F_1 \reduce F_2$ between morphisms $(f_1, F_1, \mathfrak{f}_1)$
%and $(f_2, F_2, \mathfrak{f}_2)$ as two cells since $F_1 \reduce F_2$ implies $F_1[M] \reduce F_2[M]$.
%That is, we do have a $2$-category of assemblies in the spirit of Seely's $2$-categorical model~\cite{Seely1987}.
%This line of research is out of scope of this paper, so we refrain ourselves from further discussion. 

\subsection{Extensional equality and \texorpdfstring{$\PP$}{P}-category of assemblies}

Now define the partial equivalence relation $\sim$ referred to as the extensional equality on trackable maps by $f_1 \sim f_2$ if $\bproj{f_1} = \bproj{f_2}$. We say that $f_1$ and $f_2$ are \emph{extensionally equal} if $f_1 \sim f_2$.
\begin{proposition}
  The type $\Asm_0$ of assemblies and the family of types $\Asm_1(X, Y)$ for any two assemblies $X$ and $Y$ with the extensional equality form a $\PP$-category~$\Asm(\Lambda)$.
\end{proposition}

We now investigate some of its basic properties.

\begin{example}[Terminal object]
  The unit assembly $\top \defeq (\Unit, \Vdash_{\Unit}, r_{\Unit}, t_{\Unit})$ is $\PP$-terminal where 
  \begin{romanenumerate}
    \item $\Unit$ is the unit type,  
    \item $\Vdash_{\Unit}$ a relation defined by $M \Vdash_{\Unit} \star \defeq M \reduce \mathtt{\lambda x.\, x}$, 
    \item $r_{\Unit}: (M \reduce N) \to (N \reduce L) \to (M \reduce L)$ given by the transitivity of the reduction relation $\reduce$,
    \item and $t_{\Unit}$ the fact that the only inhabitant $\star : \Unit$ has a realiser $\mathtt{\lambda x.\, x}$ (by reflexivity).
  \end{romanenumerate}
  The finality follows from the function extensionality.
\end{example}

Every inhabitant of (the carrier of) an assembly $X$ corresponds to a merely trackable map from $\top$ to $X$.
Moreover, distinct merely trackable maps can be separated by global elements in the ordinary category of assemblies and merely trackable maps. 
In $\Asm(\Lambda)$ where trackers are part of trackable maps, a global element can be constructed for any pair of inhabitant $x : \bproj{X}$ and its realiser.
\begin{lemma}\label{lem:global-element}
  Let $X$ be an assembly. Then the following statements hold:
  \begin{enumerate}
    \item Every inhabitant $x_0 : \bproj{X}$ corresponds to a merely trackable map from $\top$ to $X$.
    \item Every pair of $x_0 : \bproj{X}$ and $M : \Lambda_0$ with $r_0 : M \Vdash_X x$ defines a global element of $X$, i.e.\ a trackable map from $\top$ to $X$.
  \end{enumerate}
\end{lemma}

As expected, the terminal object $\top$ in~$\ASM(\Lambda)$ is a separator up to~$\sim$ in the sense that $f_1 \sim f_2$ if $f_1 \circ x \sim f_2 \circ x$ for every global element~$x$ of $X$.
This property relies on the property that the carrier $\bproj{X}$ is a set.
\begin{proposition}
  Let $f_1, f_2 : X \to Y$ be two trackable maps. Then, 
  $f_1$ is extensionally equal to $f_2$ if
  $f_1 \circ x \sim f_2 \circ x$ for every global element $x$ to $X$ 
\end{proposition}
\begin{proof}[Proof sketch]
  By function extensionality, it suffices to define a trackable map $(\mathsf{c}_x, M_x, \mathfrak{M}_x)$ from $\top$ to $X$ for any inhabitant $x : \bproj{X}$, where $\mathsf{c}_x(\star) = x$.
  Then, we show that there is a path $f_1\,x = f_2\,x$ independent of the choice of $M_x$ and $\mathfrak{M}_x$, by the right totality $t_X$, the recursion principle of propositional truncation, and the assumption that $\bproj{Y}$ is a set. 
\end{proof}

\begin{corollary}
  The terminal object $\top$ is a separator in $\Asm(\Lambda)$.
\end{corollary}

It is straightforward but tedious to define the $\PP$-product of assemblies, so we omit the details from the paper.
%so we leave this as an exercise to the reader.
\begin{example}[Initial object]
The empty assembly $\bot$ is $\PP$-initial consisting of the empty type $\Empty$ and a relation $\Vdash_\bot : \Lambda_0 \to \Empty \to \setU$ given by the elimination rule for the empty type.
The other two components $r_\Empty$ and $t_\Empty$ are trivial.
\end{example}

In addition, one can show that $\bot$ is even a \emph{strict} initial object. That is, 
\begin{proposition}\label{prop:strict-initial}
  Any trackable map from some assembly $X$ to $\bot$ is a $\PP$-isomorphism. 
\end{proposition}
The strictness of $\bot$ follows easily from that for any type $X$ with a function $X \to \Empty$ one can show the equivalence $\eqv{\Empty}{X}$ in HoTT.
From the strictness of the initial object, no morphism from $\top$ to $\bot$ could exist, since $\top$ is not equivalent to $\bot$.

The construction of exponential $X \Rightarrow Y$ is a bit intriguing.
With the definition of trackable maps, we may expect the exponential assembly $X \Rightarrow Y$ to consist of trackable maps.
However, the exponential assembly $X \Rightarrow Y$ has the type of \emph{merely} trackable maps as its carrier, since the carrier is meant to be the type of \emph{extensions} of trackable maps.
\begin{example}[Exponential]
  Given assemblies $X$ and $Y$, define
  \begin{align*}
    \bproj{X \Rightarrow Y} & \defeq \sm{f : |X| \to |Y|} \exis{F : \Lambda_1} \mathsf{Tracks}_{X, Y}(F, f) \equiv \sm{f : |X| \to |Y|} \brck{\sm{F : \Lambda_1} \mathsf{Tracks}_{X, Y}(F, f) }
  \end{align*}
  with the realisability relation 
  \[
    L \Vdash_{X \Rightarrow Y} (f, \star) \defeq \prd{M : \Lambda_0}{x : |X|} \left( M \Vdash_X x\right) \to \left(L\,M \Vdash_Y f\,x\right).
  \]
  It remains to construct $r_{X\Rightarrow Y}$ and $t_{X \Rightarrow Y}$. 
  We know that $L' \reduce L$ implies $L'\,M \reduce L\,M$, so $L'$ realises $(f, \star)$ whenever $L$ realises $(f, \star)$ and $L' \reduce L$ by $r_Y$.
  For every $(f, \star) : |X \Rightarrow Y|$, there merely exists a tracker of $f$, say $F$.
  We see that $L \defeq \left(\mathtt{\lambda x}.\,F\right)$ realises $(f, \star)$, since
  $\left(\mathtt{\lambda x}.\,F\right)\,M \onereduce F[M]$ for any $M$ and $F[M] \Vdash_Y f\,x$ whenever $M \Vdash x$.
  By applying the recursion principle of the truncated type $\brck{\sm{F : \Lambda_1} \mathsf{Tracks}_{X, Y}(F, f) }$ to the second component of $(f, \star)$, there merely exists a realiser of $(f, \star)$, i.e.\ an inhabitant $t_{X \Rightarrow Y}$ for the right totality.

  \ltnote{show that $X \Rightarrow Y$ has the required universal property formally.}
\end{example}

To sum up, we have just showed that $\Asm(\Lambda)$ has a strict initial object, finite products, and exponentials.
\begin{corollary}
  $\Asm(\Lambda)$ is a cartesian closed $\PP$-category with a strict initial object.
\end{corollary}
\ltnote{shall we show that $\Asm(\Lambda)$ has a natural number object?}

\section{Realisability semantics for two modalities}\label{sec:provability}

In this section, we first introduce an exposure $\boxtimes\colon \Asm(\Lambda) \looparrowright \Asm(\Lambda)$ which models an \SFour modality but is subtly different from the comonadic exposure $\boxtimes_K$ introduced by Kavvos~\cite{Kavvos2017b}.
For example, $\boxtimes_K$ preserves finite products including the terminal object~$\top$, but ours does not.%
\hsnote{forward reference to \Cref{re:boxtimes-is-not}}
Most importantly, we are able to refute the completeness principle $X \to \boxtimes X$ understood as a quoting function from the computational perspective, while we did not find a way to refute it with $\boxtimes_K$.
Hitherto, we have reconstructed a similar but different model~$\boxtimes$ in HoTT than the set-theoretic model~$\boxtimes_K$ based on a PCA studied by Kavvos.

Thereafter, we use an extension of cubical type theory with Löb induction---clocked cubical type theory~\cite{Bahr2017,Kristensen2021}---and introduce an exposure-like construction $\Box$ to model the \GL modality.
We will show that $\Box$ refutes not only the completeness principle by the same argument for $\boxtimes$ but also the reflection principle $\Box X \to X$ which is valid for $\boxtimes$ but logically inconsistent with Gödel-Löb axiom.
Finally, we establish one of the main contributions of this paper: given a trackable map $f : \Box X \to X$ tracked by~$F$ there is an inhabitant of $\Box X$ realised by~$\qquote{\mathsf{fix}\,F}$
where $\mathsf{fix}\,F$ is the fixpoint given by the Second Recursion Theorem.
This is exactly the deductive form of the Gödel-Löb axiom in $\Asm(\Lambda)$.


\subsection{An exposure for \texorpdfstring{\SFour}{S4} modality}
An assembly $X$ records the interplay between intensions (i.e.\ terms) and extensions, so it is possible to bring out intensions to the level of extensions by pairing $x : \bproj{X}$ with a term $M$ which realises $x$ as the carrier of $\boxtimes X$.
A pair $(M, x, r)$ with $r : M \Vdash_X x$ should be thought as the extension $x$ along with its \emph{extensional} representation~$M$.
Thus, we argue that $(M, x, r)$ shall be realised by terms which are $\beta$-equivalent to its code $\qquote{M}$ (instead of $M$ as proposed by Kavvos~\cite{Kavvos2017b}), since terms $N$ with $N \reduce \qquote{M}$ are \emph{intensional} representations of $M$.%
\hsnote{revise}
In short, the carrier and the realisability relation are defined as
\[
  \bproj{\boxtimes X} \defeq \sm{M : \Lambda_0}{x : \bproj{X}} M \Vdash x
  \quad\text{and}\quad
  \left(N \Vdash_{\boxtimes X} (M, x, r)\right) \defeq N \reduce \qquote{M}
\]
respectively.
It turns out that $\boxtimes X \defeq (\bproj{\boxtimes X}, \Vdash_{\boxtimes X}, r_{\boxtimes X}, t_{\boxtimes X})$ is indeed an assembly where $r_{\boxtimes X}$ and $t_{\boxtimes X}$ are the transitivity and the reflexivity of $\reduce$.

As for the mapping on morphisms, consider any trackable map $f$ from $X$ to $Y$ and define $\boxtimes f \defeq (\bproj{f}^\boxtimes, F^\boxtimes, \mathfrak{f}^\boxtimes)\colon \boxtimes X \to \boxtimes Y$ as follows.
First define a function from $\bproj{\boxtimes X}$ to $\bproj{\boxtimes Y}$ by
\[
  \bproj{f}^\boxtimes\colon (M, x, r) \mapsto (F[M], \bproj{f}\,x, \mathfrak{f}\,M\,x\,r).
\]
To give a tracker of $f^\boxtimes$ recall that there is a term $\mathtt{subst}$ performing term substitution on codes, so the term $F^\boxtimes \defeq \mathtt{subst}\,\qquote{F}\,\mathtt{x}$ tracks $f^\boxtimes$ because of
\begin{align*}
  \mathtt{subst}\,\qquote{F}\,N 
  \reduce \mathtt{subst}\,\qquote{F}\,\qquote{M}
  \reduce \qquote{F[M]} \Vdash_{\boxtimes Y} f^\boxtimes(M, x, r)
\end{align*}
completing the definition of $\mathfrak{f}^\boxtimes$.
In short, $\boxtimes f\defeq(\bproj{f}^\boxtimes, F^\boxtimes, \mathfrak{f}^\boxtimes)$ is a trackable map.

\begin{example} \label{ex:global-element-of-unit}
  The global element $\bigstar\colon \top \to \boxtimes \top$ corresponding to the designated inhabitant~$\star : \Unit$ is given by $(\mathtt{I}, \star, \refl_\twoheadrightarrow)$ with a realiser $\qquote{\mathtt{I}}$ using \Cref{lem:global-element}. 
  Yet, there are other global elements of $\boxtimes \top$ such as $(\mathtt{I}\,\mathtt{I}, \star, \beta)$ realised by $\qquote{\mathtt{I\,I}}$ where $\beta : \mathtt{I}\,\mathtt{I} \onereduce \mathtt{I}$ is the $\beta$-reduction rule. 
  Furthermore, the tracker of a global element might not even be a closed term but a open term. 
\end{example}

The above example shows that $\boxtimes \top$ cannot be $\PP$-isomorphic to $\top$, since there are countably many representations for $\star : \Unit$, i.e.\ inhabitants of $\bproj{\boxtimes \top}$ while there is exactly one inhabitant of $\bproj{\top} \equiv \Unit$. 
Similarly, there are trackable maps from $\boxtimes (X \times Y)$ to $\boxtimes X \times \boxtimes Y$ and vice versa, but they are not $\PP$-isomorphic.\ltnote{write it down formally}

\begin{theorem}[{\emph{cf}.~\cite[Theorem~11]{Kavvos2017b}}]\label{thm:S4-exposure}
  $\boxtimes\colon \Asm(\Lambda) \looparrowright \Asm(\Lambda)$ is an exposure of assemblies.
  Moreover, there is an evaluator $\epsilon$ for $\boxtimes$, i.e.\ a natural transformation~$\epsilon$ from $\boxtimes$ to $\mathcal{I}$.
\end{theorem}

\begin{proof}[Proof sketch]
  It is routine to prove the preservation of identities and composition.
  For example, it follows by definition that $\idfunc[\bproj{X}]^\boxtimes (M, x, r) \equiv (\mathtt{x}[M], x, \pr_3\,M\,x\,r) \equiv (M, x, r)$.

  Now we show that $\boxtimes$ reflects the extensional equality.
  Let $f$ and $g$ be trackable maps from $X$ to~$Y$.
  By assumptions that $\boxtimes f \sim \boxtimes g$ and that there are merely $M : \Lambda_0$ with $r : M \Vdash_X x$, we can apply
  the recursion principle of propositional truncation to derive 
  \[
    \boxtimes f(M, x, r) = (F[M], \bproj{f}\,x, \mathfrak{f}\,M\,x\,r)
    = (G[M], \bproj{g}\,x, \mathfrak{g}\,M\,x\,r) = \boxtimes g (M, x, r)
  \]
  since the identity type on $\boxtimes Y$ is a proposition.
  Therefore, we have $\prd{x : \bproj{X}} \bproj{f}\,x =_Y \bproj{g}\,x$.
  By function extensionality it then follows that $\left(\bproj{f} =_{\bproj{X} \to \bproj{Y}} \bproj{g}\right) \equiv f \sim g$.

  As for the evaluator $\epsilon_X\colon \boxtimes X \to X$, recall the term $\mathtt{eval}$ which evaluates a code to its representing term. 
  We simply define $\bproj{\epsilon_X}$ by $(M, x, r) \mapsto x$. 
  Then, whenever given $N : \Lambda_0$ with $N \reduce \qquote{M}$, we have $\mathtt{eval}[N] \reduce \mathtt{eval}[\qquote{M}] \reduce M$ where $M \Vdash_X x$ is witnessed by~$r$.
  That is, $\bproj{\epsilon_X}$ is tracked by~$\mathtt{eval}$.
  The naturality of $\epsilon$ follows by definition.
\end{proof}

In addition, there are functions $\bproj{\delta_X}(M, x, r) \defeq (\qquote{M}, (M, x, r), \refl_\twoheadrightarrow)$ from $\bproj{\boxtimes X}$ to $\bproj{\boxtimes \boxtimes X}$ tracked by~$\mathtt{quote}$ corresponding to the quotation of a quoted term. 
For any global element $a\colon \top \to \boxtimes X$ given by~\Cref{lem:global-element} whose tracker is indeed the quoted term~$\qquote{M}$, we can see that $\delta_X \circ a \colon \top \to \boxtimes \boxtimes X$ coincides with $\boxtimes a \circ \bigstar$ up to~$\sim$ as follows:
\[
  \bproj{\delta_X}(a(\star)) \equiv \bproj{\delta_X}(M, x, r) \equiv (\qquote{M}, (M, x, r), \refl_\twoheadrightarrow)
  = \bproj{\boxtimes a}(\mathtt{I}, \star, \refl_\twoheadrightarrow) \equiv \bproj{\boxtimes a}(\bigstar(\star)).
\]

\begin{remark} \label{re:boxtimes-is-not}
One may expect that $(\boxtimes, \epsilon, \delta)$ is comonadic in the sense that $\delta$ is also a natural transformation up to~$\sim$ satisfying comonad laws.
However, unlike the exposure $\boxtimes_K$ introduced by Kavvos~\cite[Theorem~11]{Kavvos2017a}, these maps $\delta_X$ are unfortunately \emph{not} natural in~$X$.
Indeed, for each trackable map $f\colon X \to Y$ the inhabitant 
\[
  \delta_Y (\boxtimes f(M, x, r))
  \equiv \left(\qquote{F[M]}, (F[M], f\,x, \mathfrak{f}\,M\,x\,r), \refl_{\twoheadrightarrow}\right)
\]
of type $\boxtimes \boxtimes Y$ is not equal to
\[
  \boxtimes \boxtimes f (\delta_X(M, x, r))
  \equiv (\mathsf{subst}\,\qquote{F}\,\qquote{M}, (F[M], f\,x, \mathfrak{f}\,M\,x\,r), \mathsf{subst}_{\twoheadrightarrow})
\]
in spite that their extensions $(F[M], f\,x, \mathfrak{f}\,M\,x\,r)$ are the same
where $\mathsf{subst}_{\twoheadrightarrow}$ is the witness of the reduction sequence $\mathsf{subst}\,\qquote{F}\,\qquote{M} \reduce \qquote{F[M]}$.
Nevertheless we may consider a partial order induced by the reduction relation $\mathsf{subst}\,\qquote{F}\,\qquote{M} \reduce \qquote{F[M]}$.
In detail, for inhabitants of $\boxtimes X$ define $(M, x, r) \leq (N, y, s)$ if $M \reduce N$ and $x = y$, and
accordingly define $f \leq g$ if $\bproj{f}\,x \leq \bproj{g}\,x$ for any $x$.
Then we have $\bproj{\boxtimes \boxtimes f \circ \delta_X} \leq \bproj{\delta_Y \circ \boxtimes f}$ instead.
This kind of transformations $\delta$ are called \emph{lax natural transformations}.
\end{remark}

What \Cref{re:boxtimes-is-not} implies is that the ordinary naturality is not always the right notion in the presence of intensionality, since the intension part of $\boxtimes f$ is only applied verbatim.

\begin{remark} \label{re:difference-boxtimes}
  The exposure $\boxtimes_K$ defined for assemblies on a PCA is with the carrier and the realisability relation given by
  \[
    \bproj{\boxtimes_K X} \defeq \{\,(M, x) \mid M \Vdash x \,\}
    \quad\text{and}\quad
    N \Vdash_{\boxtimes_K X} (M, x) \defeq N = M
  \]
  without the Gödel encoding. 
  It gives rise to not only an exposure but also a comonadic exposure.
  Moreover $\boxtimes_K$ preserves finite products including the terminal object $\top$.
  Preserving finite products is considered \emph{unsatisfactory} because intensions, i.e.\ elements of a PCA, are subject to certain equations already as those representations are identified on the level of PCA.
  By taking $\lambda$-terms subject only to $\alpha$-equivalence as realisers, we are able to distinguish computationally equivalent intensions---the main point of introducing the $\PP$-category of assemblies.

\hsnote{which is unsatisfactory because\ldots How does $\boxtimes$ avoid the problem?}

\end{remark}

\begin{lemma}\label{lem:no-quoting}
  The function $\eta_\Lambda \colon \Lambda_0 \to \boxtimes \Lambda_0$ defined by 
  \[
    M \mapsto (M, M, \refl_\twoheadrightarrow)
  \] 
  is not trackable by any term.
\end{lemma}
\begin{proof}
  Suppose that $\eta_\Lambda$ is tracked by~$\mathtt{Q}$.
  Being a tracker for a function from $\Lambda_0$ to $\boxtimes \Lambda_0$ means that $\mathtt{Q}[N]\reduce \qquote{M}$ whenever $N \reduce M$.
  In particular, it follows that $\mathtt{Q}[M] \reduce \qquote{M}$.
  By~\Cref{prop:no-quoting} such $\mathtt{Q}$ cannot exist.
\end{proof}

\begin{theorem}\label{thm:S4-no-quoting}
  There is no natural transformation $\eta$ from $\mathcal{I}$ to $\boxtimes$.
\end{theorem}
\begin{proof}
  Assume that such a family of trackable maps $\eta_X\colon X \to \boxtimes X$ exist.
  To prove the statement, it suffices to show that $\bproj{\eta_\Lambda}\,M_0$ is propositionally equal to $(M_0, M_0, \refl_{\twoheadrightarrow})$ so that this family $\eta$ cannot exist by \Cref{lem:no-quoting}.
  By \Cref{lem:global-element}, every closed term $M_0$ gives a trackable map $\widehat{M_0} \defeq (\lambda x.\, M_0, M_0, \mathfrak{M_0}) \colon \top \to \Lambda$ where $\mathfrak{M_0}$ is propositionally equal to the constant function with the value $\refl_{\twoheadrightarrow} : M_0 \reduce M_0$.

  Note that $\bproj{\boxtimes\widehat{M_0}}(M, x, r) = (M_0, M_0, \refl_\twoheadrightarrow)$ by definition for any inhabitant $(M, x, r)$ of type $\boxtimes \top$.
  Hence, by naturality, $\bproj{\eta_{\Lambda}}\,M_0 \equiv \bproj{\eta_{\Lambda}} \left(\bproj{\widehat{M_0}}\,\star\right) =  \bproj{\boxtimes\widehat{M_0}}\,(\bproj{\eta_\top}\,\star) = (M_0, M_0, \refl_\twoheadrightarrow)$.

\end{proof}

It remains unclear to us if the existence of a transformation $\mathcal{I} \to \boxtimes_K$ can be refuted.

\begin{remark}\label{re:S4-modality}
  Recall that the modal type theory considered by Davies and Pfenning~\cite{Davies2001b} is a dual-context simple type theory extended with an \SFour modality $\Box$, a construct $\mathtt{box}$, a $\mathtt{let}$-expression for boxed terms, and typing rules below.
\[
\begin{minipage}{.47\linewidth}
  \begin{prooftree}
    \AxiomC{$\Delta; \cdot \vdash E : A$}
    \UnaryInfC{$\Delta; \Gamma \vdash \mathtt{box}\,E:\Box A$}
  \end{prooftree}
\end{minipage}%
\begin{minipage}{0.47\linewidth}
  \begin{prooftree}
    \AxiomC{$\Delta; \Gamma \vdash E_1 : \Box A$}
    \AxiomC{$\Delta, u : A; \Gamma \vdash E_2 : B$}
  \BinaryInfC{$\Delta; \Gamma \vdash \mathtt{let}\,\mathtt{box}\, u = E_1\, \mathtt{in}\,E_2 : B$}
  \end{prooftree}
\end{minipage}
\]

Following \Cref{thm:S4-exposure,thm:S4-no-quoting}, we anticipate an interpretation of $\Box$ to justify the `omitted congruence rule' for the $\mathtt{box}$ construct~\cite[Section~2.5]{Davies2001b} and the absence of quoting function $A \to \Box A$ in their system.
\hsnote{a brief recap on the `omitted congruence rule'}
\end{remark}

\subsection{An exposure for \texorpdfstring{\GL}{GL} modality}
It is known that the Gödel-Löb axiom $\Box(\Box A \to A) \to \Box A$ is incompatible with the reflection principle $\Box A \to A$.
Indeed, let $A$ be the falsity $\bot$ for both laws. Then, we have
\[
  \Box(\Box \bot \to \bot) \to \Box \bot
  \quad\text{and}\quad
  \Box \bot \to \bot
\]
By the necessitation rule and modus ponens, $\Box (\Box \bot \to \bot)$ as well as $\bot$ are derivable.
Yet, by \Cref{prop:strict-initial,thm:S4-exposure}, we cannot expect the exposure $\boxtimes$ to model the Gödel-Löb axiom.
Mysteriously, the provability modality $\Box$ and the Gödel-Löb axiom are suggested to be understood also as the type of code of type~$A$ (cf.~\Cref{re:S4-modality}) and as \emph{intensional recursion} respectively from the computational perspective~\cite{Kavvos2017b}, if one is willing to give up consistency.

To untie the knot but to retain consistency and the interpretation of $\Box A$ as code of type~$A$, we refine our interpretation with a notion of \emph{computation stages}. 
Considering the counit $\epsilon_X\colon \boxtimes X \to X$, it is possible to evaluate $(M, x, r)$ because the code is already available for doing so.
And, its provability reading suggests that inhabitants of $\Box X$ are not available at the current stage but on a meta-level.
To express this idea cleanly, we work with Nakano's later modality~$\laterp$ and guarded recursion~\cite{Nakano2000}.
\hsnote{need a better story}

\subsubsection{Digression: Clocked Cubical Type Theory}
This section presents a crash course on clocked cubical type theory~\cite{Kristensen2021}, CCTT for short, which consists of two extensions of dependent type theory.
The first extension is the machinery to manipulate $n$-dimensional cubes such as paths, squares, cubes, etc., allowing us to prove Voevodsky’s univalence axiom and function extensionality directly.
The second extension adds a sort $\clock$ with \emph{ticks} to support Nakano style guarded recursion (also known as Löb induction) introduced by Bahr et al.~\cite{Bahr2017}.

Clocks are of a different sort~$\clock$ than types, so usual type formers (such as $\to$) are not applicable.
A clock~$\kappa$ is introduced by a clock quantification~$\forall \kappa.\, A$ into a context with rules similar to those for $\Pi$-types:
\[
  \begin{minipage}{0.47\linewidth}
    \begin{prooftree}
      \AxiomC{$\Gamma, \kappa : \clock \vdash t : A$}
      \UnaryInfC{$\Gamma \vdash \Lambda \kappa.\, t : \forall \kappa.\, A $}
    \end{prooftree}
  \end{minipage}
  \begin{minipage}{0.47\linewidth}
    \begin{prooftree}
      \AxiomC{$\Gamma \vdash t : \forall \kappa.\, A$}
      \AxiomC{$\Gamma \vdash \kappa' : \clock $}
      \BinaryInfC{$\Gamma \vdash t[\kappa'/\kappa] : A[\kappa'/\kappa]$}
    \end{prooftree}
  \end{minipage}
\]
For convenience, a clock constant~$\kappa_0$ is presumed in the type theory.

A new type $\laterp (\alpha : \kappa). A$ on a clock~$\kappa$ is introduced as a type of suspended computations requiring a tick~$\alpha$ to compute inhabitants of~$A$.
For the ease of notation, $\laterp (\alpha : \kappa).\,A$ is written as $\laterp^\kappa\, A$ if the tick variable is not referred.
Formally, the following are rules for ticks:
\[
  \begin{minipage}{0.47\linewidth}
    \begin{prooftree}
      \AxiomC{$\Gamma, \alpha : \kappa \vdash t : A$}
      \UnaryInfC{$\Gamma \vdash \lambda (\alpha : \kappa).\, t : \laterp (\alpha : \kappa).\, A$}
    \end{prooftree}
  \end{minipage}
  \begin{minipage}{0.47\linewidth}
    \begin{prooftree}
      \AxiomC{$\Gamma \vdash t : \laterp (\alpha : \kappa).\, A$}
      \AxiomC{$\Gamma, \beta , \Gamma' \vdash$}
      \BinaryInfC{$\Gamma, \beta : \kappa , \Gamma' \vdash t[\beta] : A[\beta/\alpha]$}
    \end{prooftree}
  \end{minipage}
\]
where the elimination rule separates variables occurring before and after $\alpha$ in a context. 
The intuition that a tick is a time resource is reflected by its elimination rule.
For example, $\lambda (x : \laterp^\kappa\,\laterp\,A).\, \lambda (\alpha : \kappa).\, x [\alpha][\alpha]$
is not typable but is
\[
  \Lambda \kappa.\, \lambda f.\,\lambda x.\,\lambda \alpha.\, f[\alpha]\,(x[\alpha]) : \forall \kappa.\, \laterp^\kappa(A \to B) \to \laterp^\kappa A \to \laterp^\kappa B.
\]
An inhabitant of $A$ is available in a time step given by $\mathtt{next} \defeq \Lambda \kappa.\, \lambda x.\,\lambda \alpha.\, x \colon \forall \kappa.\, A \to \laterp^\kappa A$. 

An inhabitant of $\laterp (\alpha : \kappa).\, A$ can tick on a different clock by a constant tick~$\diamond$ stated by 
\begin{prooftree}
  \AxiomC{$\Gamma, \kappa : \clock \vdash t : \laterp (\alpha : \kappa).\, A$}
  \AxiomC{$\Gamma \vdash \kappa' : \clock$}
  \BinaryInfC{$\Gamma \vdash (t[\kappa'/\kappa])[\diamond] : A[\kappa'/\kappa][\diamond/\alpha]$}
\end{prooftree}
allowing $\laterp^\kappa$ to be eliminated in a clock~$\kappa'$ different from~$\kappa$.
This tick~$\diamond$ is needed to type Atkey and McBride's~\cite{Atkey2013b} operator
  $\mathsf{force} \defeq \lambda x.\, \Lambda \kappa.\, x[\kappa][\diamond]
  : (\forall \kappa.\, \laterp^\kappa A) \to \forall \kappa.\, A$.

  Finally, every function $t : \laterp^\kappa A \to A$ has a delayed fixed point $\mathsf{dfix}\,t : \laterp^\kappa A$ with a path replacing the judgemental fixed point equation (to ensure the termination of reduction semantics), called \emph{guarded recursion}.
Formally, there are two more rules
\[
  \begin{minipage}{0.47\linewidth}
    \begin{prooftree}
      \AxiomC{$\Gamma \vdash t : \laterp^\kappa A \to A$}
      \UnaryInfC{$\Gamma \vdash \mathsf{dfix}\,t : A$}
    \end{prooftree}
  \end{minipage}
  \begin{minipage}{0.47\linewidth}
    \begin{prooftree}
      \AxiomC{$\Gamma \vdash t : \laterp^\kappa A \to A$}
      \UnaryInfC{$\Gamma \vdash \mathsf{pfix}^\kappa t : \mathrm{Path}_A\;\left(\mathsf{dfix}\,t[\alpha]\right)\;\left(t(\mathsf{dfix}\,t)\right)$}
    \end{prooftree}
  \end{minipage}
\]
where $\mathrm{Path}_A\;x\;y$ is the type of paths from $x$ to $y$.

We now list properties needed for~\Cref{sec:GL}.
Being a proposition is irrelevant to ticks and clocks, so is being a set.
The proof is based on the fact that tick variables cannot be exchanged in a context with ordinary variables but  variables of the interval~$\mathbb{I}$.
\begin{lemma}
  If $\laterp (\alpha : \kappa).\, \mathsf{isProp}\,(A [\alpha])$ is inhabited, then so is $\mathsf{isProp}\,\laterp(\alpha: \kappa).\, A [\alpha]$. 
  Similarly, if $\laterp (\alpha : \kappa).\, \mathsf{isSet}\,(A [\alpha])$ is inhabited, then so is $\mathsf{isSet}\,\laterp(\alpha: \kappa).\, A [\alpha]$. 
\end{lemma}

The later modality distributes over a $\Sigma$-type.
It follows from that the function from $\sm{x : \laterp^\kappa A} \laterp (\alpha : \kappa).\, B\,(x[\alpha])$ to $\laterp^\kappa \left(\sm{x : A} B\,x\right)$ mapping $(x, y)$ to $\lambda (\alpha : \kappa).\, (x[\alpha], y[\alpha])$ has a quasi-inverse which entails equivalence between types.
\begin{lemma}\label{lem:later-sum}
  For $A : \UU$ and $B : A \to \UU$, there is an equivalence
  \begin{equation}\label{eq:later-sum}
    \eqv{\laterp^\kappa \sm{x : A} B\,x}{\sm{x : \laterp^\kappa A} \laterp (\alpha : \kappa).\, B (x [\alpha])}.
  \end{equation}
  between $\Sigma$-types.
\end{lemma}

By univalence, guarded recursion has a particular form for $\Sigma$-types:
\begin{corollary} \label{coro:lob-induction-sum}
  Suppose that the type $\sm{x : \laterp A} \laterp (\alpha : \kappa).\,B\,(x[\alpha]) \to \sm{x : A} B\,x$ is inhabited.
  Then $\sm{x : A} B\,x$ is inhabited.
\end{corollary}

The $\mathtt{force}$ operator is an inverse of~$\mathtt{next}$ in the following sense:
\begin{lemma}
  Let $x$ be an inhabitant of $\forall \kappa.\, A$. Then, 
  $\mathtt{force}\,(\lambda \kappa.\,\lambda (\alpha : \kappa).\, x [\kappa])\,\kappa = x\,\kappa$ is inhabited for any clock $\kappa$.
\end{lemma}

It follows that a path between two inhabitants $\mathtt{next}\,x_i$ in a time step gives rise to a path now.
In other words, paths are timeless.
\begin{proposition}\label{lem:later-identity}
  Let $x$ and $y$ be inhabitants of $A$. Then, $\forall \kappa.\, \left(\mathtt{next}\,\kappa\,x_1 = \mathtt{next}\,\kappa\,x_2\right)$ implies $x_1 = x_2$.
\end{proposition}
Be aware of the scope of clock quantification.
The above proposition cannot hold within the same clock, that is, $\forall \kappa.\, \left(\mathtt{next}\,\kappa\,x_1 = \mathtt{next}\,\kappa\,x_2 \to x_1 =x_2\right)$ is not provable, since intuitively it would require us to retrieve inhabitants available later \emph{right now}.
In order to formulate the faithfulness of an exposure, the definition is adopted with a clock variable accordingly.
\begin{definition}[Clocked exposure]
  Given $\PP$-categories $\mathbf{C}$ and $\mathbf{D}$, a \emph{clocked exposure} $Q\colon \mathbf{C} \looparrowright \mathbf{D}$ consists of \emph{(a)} a mapping $Q$ for each clock $\kappa$ from objects $X$ of $\mathbf{C}$ to objects~$Q^\kappa X$ of $\mathbf{D}$ and \emph{(b)} for each clock $\kappa$ from well-defined morphisms $f\colon X \to Y$ to well-defined morphisms $Q^\kappa f\colon Q^\kappa X \to Q^\kappa Y$ satisfying following properties
  \begin{romanenumerate}
    \item $Q^\kappa \iid_X \sim \iid_{QX}$,
    \item $Q^\kappa (g \circ f) \sim Q^\kappa g \circ Q^\kappa f$, and
    \item $f \sim g$ whenever $Q^\kappa f \sim Q^\kappa g$ for any clock $\kappa$ and for any two well-defined morphisms $f, g\colon X \to Y$. 
  \end{romanenumerate}
\end{definition}
\Cref{thm:GL-exposure} gives an example of clocked exposure.

\subsubsection{Back to \texorpdfstring{\GL}{GL}} \label{sec:GL}

Now we introduce the clocked exposure $\Box^\kappa \colon \Asm(\Lambda) \to \Asm(\Lambda)$ modelling the \GL modality. 
For an assembly $X$, the carrier $\bproj{\Box^\kappa X}$ and its realisability relation $\Vdash_{\Box^\kappa}$ are defined as
\[
  \bproj{\Box^\kappa X} \defeq \sm{M : \Lambda_0}{x : {\laterp^\kappa \bproj{X}}} \laterp (\alpha : \kappa) .\, M \Vdash_X x [\alpha]
  \quad\text{and}\quad
  \left(N \Vdash_{\Box^\kappa X} (M, x, \star) \right) \defeq N \reduce \qquote{M}
\]
where $\Vdash_{\Box^\kappa X}$ is defined as the same as the comonadic exposure~$\boxtimes$.
The only difference between carriers $\bproj{\Box^\kappa X}$ and $\bproj{\boxtimes X}$ is that the type $\bproj{X}$ as what the intension denotes becomes $\laterp^\kappa \bproj{X}$.
That is, the extension $x$ of $(M, x, r)$ is available in the next stage but not earlier (within the clock $\kappa$), but the intension $M$ remains the same type.

For the obvious reason, we may drop the superscript $\kappa$ if there is no danger of confusion in the rest of this section.
Similarly, $\Box^\kappa X \defeq (\bproj{\Box^\kappa X}, \Vdash_{\Box^\kappa X}, r_{\Box^\kappa X}, t_{\Box^\kappa X})$ is an assembly where $r_{\Box^\kappa X}$ and $t_{\Box^\kappa X}$ are given by the transitivity and the reflexivity of $\reduce$. 

%\begin{notation*}
%  To avoid clumsy notations, the superscript of $\Box^\kappa$ is suppressed when appropriate.
%\end{notation*}

For any trackable map $f$ from $X$ to $Y$, also define $\Box^\kappa f$ as the same as $\boxtimes f$ with the exception of the function $\bproj{\Box^\kappa f}$ between carriers which are now involved with a later modality:
\[
  \bproj{\Box^\kappa f}(M, x, r) \defeq (F[M], \laterp^\kappa \bproj{f}\, x, \lambda \alpha.\, \mathfrak{f}\,M\,(x[\alpha])\,(r[\alpha]))
\]
where $(\laterp^\kappa f\, x)[\alpha]$ is judgementally equal to $f(x[\alpha])$, and $\laterp^\kappa \bproj{f} : \laterp^\kappa \bproj{X} \to \laterp^\kappa \bproj{Y}$ is given by the functoriality of the later modality~$\mathord{\laterp}^\kappa$.
The very same argument for $\boxtimes f$ shows that $\Box^\kappa f$ is indeed a trackable map from $\bproj{\Box^\kappa X}$ to $\bproj{\Box^\kappa Y}$.

\begin{remark*}
  By the equivalence~\eqref{eq:later-sum} and univalence, the carrier of $\Box^\kappa X$ is identical to
  $ \sm{M : \Lambda_0}\laterp^\kappa\, \sm{x : \bproj{X}} M \Vdash_X x$.
  This equivalent form is more convenient when used to reason about the delayed fixed point and will be used interchangeably with the original definition.
\end{remark*}

It is straightforward to show that $\Box^\kappa$ is a clocked exposure by \Cref{lem:later-identity}.
\begin{theorem}\label{thm:GL-exposure}
  $\Box^\kappa \colon \Asm(\Lambda) \looparrowright \Asm(\Lambda)$ is a clocked exposure.
\end{theorem}

Similar to~\Cref{thm:S4-no-quoting}, there is no family of trackable maps $\eta_X\colon X \to \Box^\kappa X$ natural in $X$ by the non-existence of a term $\mathtt{Q}$ with $\mathtt{Q}\,M \reduce \qquote{M}$ for any arbitrary term $M$.
\begin{theorem}\label{thm:GL-no-quoting}
  There is no natural transformation from $\mathcal{I}$ to $\Box^\kappa$ for any clock $\kappa$.
\end{theorem}


On the other hand, it is not possible to have a family of trackable maps $\epsilon_X$ from $\Box^\kappa X$ to $X$ natural in $X$, since the extension part of an inhabitant of $\Box^\kappa X$ can only be projected in a time step away from now.
\begin{theorem}\label{thm:GL-no-eval}
  There is no function from $\bproj{\Box^\kappa \bot}$ to $\bproj{\bot}$.
  In particular, there is no natural transformation from $\Box^\kappa$ to $\mathcal{I}$ for any $\kappa$.
\end{theorem}
\begin{proof}
  Assume $\epsilon_\bot \colon \bproj{\Box^\kappa \bot} \to \bproj{\bot}$ exists. 
  We will show that there is $\mathsf{bang}\colon \laterp \Empty \to \Empty$, so by Löb induction a contradiction $\mathsf{fix}\,\mathsf{bang} : \Empty$ is derivable.
  
  First, let $x$ be an inhabitant of $\laterp \Empty$. We construct an inhabitant $(M, x, r)$ of
  \[
    \Box^\kappa \bot \equiv \sm{M : \Lambda_0}{x : {\laterp \Empty}} \laterp (\alpha : \kappa) .\, M \Vdash_\bot x [\alpha]
  \]
  so that the function $\bproj{\epsilon_\bot}$ from $\bproj{\Box^\kappa \bot}$ to $\bproj{\bot} \equiv \Empty$ can be applied.
  For arbitrary closed term $M$, say $\mathtt{\lambda x.\, x}$, we apply the recursion principle~$\mathsf{rec}_{\Empty}$ of the empty type to~$x$ after a time step, so 
  \[
    r \defeq \lambda \alpha.\, \mathsf{rec}_{\Empty}\,(M \Vdash_\bot x[\alpha])\,x[\alpha]
  \]
  is an inhabitant of $\laterp (\alpha : \kappa) .\, M \Vdash_\bot x [\alpha]$ and thus $(M, x, r)$ is of type $\bproj{\Box^\kappa \bot}$. 
\end{proof}

The pay-off for disallowing evaluation is to be able to adopt guarded recursion for typed code.
From the logical perspective, it is the deductive form of the Gödel-Löb axiom.

\begin{theorem}[Intensional recursion]\label{thm:GL-recursion}
  Every function $\bproj{f} \colon \bproj{\Box^\kappa X} \to \bproj{X}$ tracked by some $F$ gives rise to a global element~$f^\dagger$ of $\Box^\kappa X$ tracked by $\qquote{\mathsf{fix}\,F}$.
\end{theorem}
This theorem follows from the Löb induction and the fact that $\mathsf{fix}\,F$ is a fixpoint of $F$
given by the Second Recursion Theorem.

\begin{proof}
  Let $f$ be a trackable map from $\Box^\kappa X$ to $X$.
  We prove this statement by Löb induction on a $\Sigma$-type (\Cref{coro:lob-induction-sum}). 
  That is, assuming 
  \[
    x : \laterp \bproj{X}
    \quad\text{and}\quad
    r : \laterp (\alpha : \kappa).\, F[\,\qquote{\mathsf{fix}\,F}\,] \Vdash x [\alpha]
  \]
  we show an inhabitant of type $\bproj{X}$ realised by $\qquote{\mathsf{fix}\,F}$ as follows.
  \begin{enumerate}
    \item First,
      $\laterp(\alpha : \kappa).\left( \mathsf{fix}\,F \Vdash x [\alpha]\right)$ has an inhabitant, say $r'$, since $\mathsf{fix}\,F$ reduces to $F[\,\qquote{\mathsf{fix}\,F}\,]$. 
    \item Then, we derive an inhabitant of type $\bproj{X}$ realised by~$F[\qquote{\mathsf{fix}\,F}$ as witnessed by
      \[
        \mathfrak{f} (\refl_{\twoheadrightarrow}\qquote{\mathsf{fix}\,F}) : F[\,\qquote{\mathsf{fix}\,F}\,] \Vdash \bproj{f}(\mathsf{fix}\,F, x, r')
      \]
    since $F$ tracks $\bproj{f}$ and the set $\qquote{\mathsf{fix}\,F} \Vdash_{\Box^\kappa X} (\mathsf{fix}\,F, x, r')$ is judgementally equal to $\qquote{\mathsf{fix}\,F} \reduce \qquote{\mathsf{fix}\,F}$ which is inhabited by~$\refl_\twoheadrightarrow$.

    \item By Löb induction, $\sm{x : \laterp \bproj{X}} \laterp (\alpha : \kappa).\, F[\qquote{\mathsf{fix}\,F}\,] \Vdash x [\alpha]$ has an inhabitant~$(x_0, r_0)$.
    \item Therefore, by $\mathsf{fix}\,F \reduce F[\qquote{\mathsf{fix}\,F}]$ again, there is an inhabitant
      $(\mathsf{fix}\,F, x_0, r_0') : \Box^\kappa X$ where $r_0' : \laterp(\alpha : \kappa).\, \mathsf{fix}\,F \Vdash x_0 [\alpha]$.
  \end{enumerate}
  Evidently $(\mathsf{fix}\,F, x_0, r_0')$ is realised by $\qquote{\mathsf{fix}\,F}$ and thus by \Cref{lem:global-element} it gives rise to a global element~$f^\dagger$ of $\Box X$, concluding our proof.
\end{proof}

We may wish to prove further that the global element $f^\dagger$ is indeed a fixpoint of $f$ in the sense that $f^\dagger \sim \Box(f \circ f^\dagger) \circ \bigstar$.
This extensional equality, however, does not hold as they have different intensions ($\mathsf{fix}\,F$ versus $F[\qquote{\mathsf{fix}\,F}]$) in spite of sharing the same extension by the fixed point equality.

\section{Conclusion}\label{sec:conclusion}

We follow the inspiring works by Kavvos in this paper to manifest the concepts of denotations, extensions, and intensions.
We have studied the $\PP$-category of assemblies on untyped $\lambda$-calculus as the foundation of categorical semantics for intensionality. 
The additional equality available in $\PP$-categories allows us to bring out intensions as morphisms which are not exposed in ordinary categories, since computationally equivalent terms are mostly identified on the semantics side \emph{a priori}, likely caused by identifying \emph{denotation} with \emph{extension}.

Based on the framework established in~\Cref{sec:assemblies}, we modelled two intensional modalities $\boxtimes$ and $\Box$ satisfying the \SFour axiom and the \GL axiom respectively.
The development of the \SFour modality $\boxtimes$ refines that of Kavvos' $\boxtimes_K$ by \Cref{thm:S4-no-quoting} and as discussed in \Cref{re:difference-boxtimes}, so the first part of results here are not just replicates of the set-theoretic results in homotopy type theory. 
As for the \GL modality, we use the clocked cubical type theory to define with a notion of computation stages.
We then show that it satisfies the deductive form of the Gödel-Löb axiom---the intensional recursion~\cite{Kavvos2017b}.
This \GL modality then partially answers the question following Theorem~5.38 in the work of Kavvos~\cite{Kavvos2020} mark one of the main contribution of this paper.
From the aspect of the design of programming languages, we expect that this line of research is useful to articulate typing disciplines of metaprogramming on which many proof assistants rely for tactic programming in a principled way.

%\paragraph*{Future work}
%First, as we have two apparently related exposures, one immediate question is how these two exposures are connected.  There is clearly a natural transformation from $\boxtimes$ to $\Box$ deferring computation to the next stage, but we do not know else much.
%The classical \SFour and \GL modalities and their connection laws are studied in Hilbert-style logic by Goris~\cite{Goris2009} with Kripke semantics in the context of provability logic.
%Accordingly, we would like to describe a type theory enriched with modalities $\boxtimes$ and $\Box$ unifying modal type theories considered by Davies and Pfenning~\cite{Davies2001b}, Pfenning~\cite{Pfenning2002a}, and by Kavvos~\cite{Kavvos2017b,Kavvos2020} while maintaining consistency.
%
%Second, inhabitants of $\Box^\kappa X$ are not accessible until the next stage. In order to arrive the next stage one needs a way to $\mathtt{force}$ them. 
%This suggests a new language construct for $\Box^\kappa X$ apart from its introduction and elimination rules considered by Kavvos~\cite{Kavvos2017a}.
%This construct may correspond to compiler-time code generation---a common form of metaprogramming during compiler-time which, to be the best of our knowledge, does not have a known denotational semantics.

%\ltnote{Third, \Cref{re:boxtimes-is-not} suggests a theory on categories enriched by \emph{partially ordered $\PP$-sets} instead}

%Finally, categories internal to clocked type theory seem worth further investigation.
%It is a natural setting when the underlying foundation is equipped with Löb induction (guarded recursion) as an abstract approach to the step-indexing technique used to reason about programming language features.
%We expect this line of research may provide a convenient framework for categorical semantics of those programming languages.
%

%If we follow the insight of Davies and Pfenning, then $\boxtimes X$ should be understood as the denotation for the type of typed code.
%As a sanity check, we may further ask the type $\mathsf{Code}$ of \emph{untyped} code and a polymorphic function from $\boxtimes A$ to $\mathsf{Code}$ forgetting what a typed code denotes. 
%This is indeed the case and the point of the following statement.
%\begin{theorem}
%
%  
%\end{theorem}

\nocite{Bauer2006}
\bibliographystyle{plainurl}% the mandatory bibstyle
\bibliography{ref}

\appendix

\end{document}
