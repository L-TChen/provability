{-# OPTIONS --without-K --cubical #-}

open import Prelude
open import Algebra.PCA.Base

module Algebra.PCA.Combinator (ğ“ : OPCA ğ“¥ ğ“¤) where
open OpcaStr (str ğ“)
  renaming (âŸ¦_âŸ§_ to âŸ¦_âŸ§áµ—_)
open Term-Reasoning ğ“

ğ¼áµ— : Term 0
ğ¼áµ— = Æ› ` 0
ğ¾áµ— : Term 0
ğ¾áµ— = Æ› Æ› ` 1

ğ‘†áµ— : Term 0
-- S = Î» x. Î» y. Î» z. xz(yz)
ğ‘†áµ— = Æ› Æ› Æ› ` 2 âŠ™ ` 0 âŠ™ (` 1 âŠ™ ` 0)

ğ¼aâ‰¼a : âˆ€ a â†’ âŸ¦ ğ¼áµ— âŠ™ áµ’ a âŸ§â‚€ â„’â‰¼ âŸ¦ áµ’ a âŸ§â‚€
ğ¼aâ‰¼a a = completeness

ğ¾abâ‰¼a : âˆ€ a b
  â†’ âŸ¦ (Æ› Æ› ` 1) âŠ™ áµ’ a âŠ™ áµ’ b âŸ§â‚€ â„’â‰¼ âŸ¦ áµ’ a âŸ§â‚€
ğ¾abâ‰¼a a b = begin
  âŸ¦ (Æ› Æ› ` 1) âŠ™ áµ’ a âŠ™ áµ’ b âŸ§ []
    â‰¼âŸ¨ â€¢â‚—-respect-â„’â‰¼ (âŸ¦ (Æ› Æ› ` 1) âŠ™ áµ’ a âŸ§â‚€) (âŸ¦ Æ› ` 1 âŸ§áµ— (a âˆ· [])) (pure b) completeness âŸ©
  âŸ¦ (Æ› ` 1) âŠ™ áµ’ b âŸ§ a âˆ· []
    â‰¼âŸ¨ completeness  âŸ©
  âŸ¦ ` 1 âŸ§ b âˆ· a âˆ· []
    âˆ 

ğ¾â†“ : âŸ¦ ğ¾áµ— âŸ§â‚€ â†“ 
ğ¾â†“ = truncElim (Î» _ â†’ âŸ¦ ğ¾áµ— âŸ§â‚€ â†“isProp) (Î» a â†’ ğ¾abâ‰¼a a a _ .fst .fst .fst) nonEmpty

ğ‘†abcâ‰¼acbc : âˆ€ a b c â†’ âŸ¦ ğ‘†áµ— âŠ™ áµ’ a âŠ™ áµ’ b âŠ™ áµ’ c âŸ§â‚€ â„’â‰¼ âŸ¦ áµ’ a âŠ™ áµ’ c âŠ™ (áµ’ b âŠ™ áµ’ c) âŸ§â‚€
ğ‘†abcâ‰¼acbc a b c = begin
  âŸ¦ ğ‘†áµ— âŠ™ áµ’ a âŠ™ áµ’ b âŠ™ áµ’ c âŸ§ []
    â‰¼âŸ¨ â€¢â‚—-respect-â„’â‰¼ âŸ¦ ğ‘†áµ— âŠ™ áµ’ a âŠ™ áµ’ b âŸ§â‚€ (âŸ¦ (Æ› Æ› ` 2 âŠ™ ` 0 âŠ™ (` 1 âŠ™ ` 0)) âŠ™ áµ’ b âŸ§áµ— _)  (pure c)
       (â€¢â‚—-respect-â„’â‰¼ âŸ¦ ğ‘†áµ— âŠ™ áµ’ a âŸ§â‚€ (âŸ¦ Æ› Æ› ` 2 âŠ™ ` 0 âŠ™ (` 1 âŠ™ ` 0) âŸ§áµ— _) (pure b) completeness)
     âŸ©
  âŸ¦ (Æ› Æ› ` 2 âŠ™ ` 0 âŠ™ (` 1 âŠ™ ` 0)) âŠ™ áµ’ b  âŠ™ áµ’ c âŸ§ a âˆ· []
    â‰¼âŸ¨ â€¢â‚—-respect-â„’â‰¼ (âŸ¦ (Æ› Æ› ` 2 âŠ™ ` 0 âŠ™ (` 1 âŠ™ ` 0)) âŠ™ áµ’ b âŸ§áµ— _) (âŸ¦ Æ› ` 2 âŠ™ ` 0 âŠ™ (` 1 âŠ™ ` 0) âŸ§áµ— _) (pure c) completeness
     âŸ©
  âŸ¦ (Æ› ` 2 âŠ™ ` 0 âŠ™ (` 1 âŠ™ ` 0)) âŠ™ áµ’ c âŸ§ b âˆ· a âˆ· []
    â‰¼âŸ¨ completeness âŸ©
  âŸ¦ ` 2 âŠ™ ` 0 âŠ™ (` 1 âŠ™ ` 0) âŸ§ c âˆ· b âˆ· a âˆ· []
    âˆ
